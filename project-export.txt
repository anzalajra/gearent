PROJECT EXPORT: Laravel
Generated: 2026-02-03 07:31:28
================================================================================


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Brand.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Str;

class Brand extends Model
{
    protected $fillable = [
        'name',
        'slug',
        'logo',
        'website',
        'is_active',
    ];

    protected $casts = [
        'is_active' => 'boolean',
    ];

    protected static function boot()
    {
        parent::boot();

        static::creating(function ($brand) {
            if (empty($brand->slug)) {
                $brand->slug = Str::slug($brand->name);
            }
        });

        static::updating(function ($brand) {
            if ($brand->isDirty('name') && empty($brand->slug)) {
                $brand->slug = Str::slug($brand->name);
            }
        });
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Cart.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class Cart extends Model
{
    protected $fillable = [
        'customer_id',
        'product_unit_id',
        'start_date',
        'end_date',
        'days',
        'daily_rate',
        'subtotal',
    ];

    protected $casts = [
        'start_date' => 'datetime',
        'end_date' => 'datetime',
        'daily_rate' => 'decimal:2',
        'subtotal' => 'decimal:2',
    ];

    public function customer(): BelongsTo
    {
        return $this->belongsTo(Customer::class);
    }

    public function productUnit(): BelongsTo
    {
        return $this->belongsTo(ProductUnit::class);
    }

    public static function calculateDays($startDate, $endDate): int
    {
        return max(1, $startDate->diffInDays($endDate));
    }

    public function recalculate(): void
    {
        $this->days = self::calculateDays($this->start_date, $this->end_date);
        $this->subtotal = $this->daily_rate * $this->days;
        $this->save();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Category.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Str;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Category extends Model
{
    // Kolom yang boleh diisi massal
    protected $fillable = [
        'name',
        'slug',
        'description',
        'image',
        'is_active',
    ];

    // Tipe data khusus
    protected $casts = [
        'is_active' => 'boolean',
    ];

    // Auto-generate slug dari name
    protected static function boot()
    {
        parent::boot();

        static::creating(function ($category) {
            if (empty($category->slug)) {
                $category->slug = Str::slug($category->name);
            }
        });

        static::updating(function ($category) {
            if ($category->isDirty('name') && empty($category->slug)) {
                $category->slug = Str::slug($category->name);
            }
        });
    }
    public function products(): HasMany
    {
        return $this->hasMany(Product::class);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Customer.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class Customer extends Authenticatable
{
    use HasFactory, Notifiable;

    protected $fillable = [
        'name',
        'email',
        'phone',
        'nik',
        'address',
        'password',
        'email_verified_at',
        'is_verified',
        'verified_at',
        'verified_by',
    ];

    protected $hidden = [
        'password',
        'remember_token',
    ];

    protected $casts = [
        'email_verified_at' => 'datetime',
        'verified_at' => 'datetime',
        'is_verified' => 'boolean',
        'password' => 'hashed',
    ];

    public function rentals(): HasMany
    {
        return $this->hasMany(Rental::class);
    }

    public function carts(): HasMany
    {
        return $this->hasMany(Cart::class);
    }

    public function documents(): HasMany
    {
        return $this->hasMany(CustomerDocument::class);
    }

    public function verifiedByUser(): BelongsTo
    {
        return $this->belongsTo(User::class, 'verified_by');
    }

    public function getActiveRentals()
    {
        return $this->rentals()
            ->whereIn('status', [Rental::STATUS_PENDING, Rental::STATUS_ACTIVE, Rental::STATUS_LATE_PICKUP, Rental::STATUS_LATE_RETURN])
            ->orderBy('start_date', 'desc')
            ->get();
    }

    public function getPastRentals()
    {
        return $this->rentals()
            ->whereIn('status', [Rental::STATUS_COMPLETED, Rental::STATUS_CANCELLED])
            ->orderBy('created_at', 'desc')
            ->get();
    }

    /**
     * Get verification status
     * - not_verified: belum upload dokumen
     * - pending: sudah upload, menunggu verifikasi
     * - verified: sudah diverifikasi admin
     */
    public function getVerificationStatus(): string
    {
        if ($this->is_verified) {
            return 'verified';
        }

        $requiredTypes = DocumentType::getRequiredTypes();
        $uploadedDocs = $this->documents()->whereIn('document_type_id', $requiredTypes->pluck('id'))->get();

        if ($uploadedDocs->isEmpty()) {
            return 'not_verified';
        }

        // Check if all required docs are uploaded and at least pending
        $allUploaded = true;
        $allApproved = true;
        
        foreach ($requiredTypes as $type) {
            $doc = $uploadedDocs->where('document_type_id', $type->id)->first();
            if (!$doc) {
                $allUploaded = false;
                $allApproved = false;
            } elseif ($doc->status !== CustomerDocument::STATUS_APPROVED) {
                $allApproved = false;
            }
        }

        if (!$allUploaded) {
            return 'not_verified';
        }

        if ($allApproved) {
            return 'verified';
        }

        return 'pending';
    }

    public function getVerificationStatusLabel(): string
    {
        return match ($this->getVerificationStatus()) {
            'verified' => 'Terverifikasi',
            'pending' => 'Sedang Diverifikasi',
            'not_verified' => 'Belum Verifikasi',
        };
    }

    public function getVerificationStatusColor(): string
    {
        return match ($this->getVerificationStatus()) {
            'verified' => 'success',
            'pending' => 'warning',
            'not_verified' => 'danger',
        };
    }

    public function canRent(): bool
    {
        return $this->is_verified;
    }

    public function getMissingRequiredDocuments()
    {
        $requiredTypes = DocumentType::getRequiredTypes();
        $uploadedTypeIds = $this->documents()->pluck('document_type_id')->toArray();
        
        return $requiredTypes->filter(function ($type) use ($uploadedTypeIds) {
            return !in_array($type->id, $uploadedTypeIds);
        });
    }

    public function verify(int $userId): void
    {
        $this->update([
            'is_verified' => true,
            'verified_at' => now(),
            'verified_by' => $userId,
        ]);
    }

    public function unverify(): void
    {
        $this->update([
            'is_verified' => false,
            'verified_at' => null,
            'verified_by' => null,
        ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\CustomerDocument.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Support\Facades\Storage;

class CustomerDocument extends Model
{
    protected $fillable = [
        'customer_id',
        'document_type_id',
        'file_path',
        'file_name',
        'file_size',
        'status',
        'rejection_reason',
        'verified_by',
        'verified_at',
    ];

    protected $casts = [
        'verified_at' => 'datetime',
    ];

    public const STATUS_PENDING = 'pending';
    public const STATUS_APPROVED = 'approved';
    public const STATUS_REJECTED = 'rejected';

    public function customer(): BelongsTo
    {
        return $this->belongsTo(Customer::class);
    }

    public function documentType(): BelongsTo
    {
        return $this->belongsTo(DocumentType::class);
    }

    public function verifiedBy(): BelongsTo
    {
        return $this->belongsTo(User::class, 'verified_by');
    }

    public function getFileUrl(): string
    {
        return Storage::url($this->file_path);
    }

    public function getFileSizeFormatted(): string
    {
        $bytes = $this->file_size;
        if ($bytes >= 1048576) {
            return number_format($bytes / 1048576, 2) . ' MB';
        }
        return number_format($bytes / 1024, 2) . ' KB';
    }

    public static function getStatusOptions(): array
    {
        return [
            self::STATUS_PENDING => 'Pending',
            self::STATUS_APPROVED => 'Approved',
            self::STATUS_REJECTED => 'Rejected',
        ];
    }

    public static function getStatusColor(string $status): string
    {
        return match ($status) {
            self::STATUS_PENDING => 'warning',
            self::STATUS_APPROVED => 'success',
            self::STATUS_REJECTED => 'danger',
            default => 'gray',
        };
    }

    public function approve(int $userId): void
    {
        $this->update([
            'status' => self::STATUS_APPROVED,
            'verified_by' => $userId,
            'verified_at' => now(),
            'rejection_reason' => null,
        ]);
    }

    public function reject(int $userId, string $reason): void
    {
        $this->update([
            'status' => self::STATUS_REJECTED,
            'verified_by' => $userId,
            'verified_at' => now(),
            'rejection_reason' => $reason,
        ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Delivery.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Delivery extends Model
{
    protected $fillable = [
        'delivery_number',
        'rental_id',
        'type',
        'date',
        'checked_by',
        'status',
        'notes',
    ];

    protected $casts = [
        'date' => 'date',
    ];

    public const TYPE_OUT = 'out';
    public const TYPE_IN = 'in';

    public const STATUS_DRAFT = 'draft';
    public const STATUS_COMPLETED = 'completed';

    protected static function boot()
    {
        parent::boot();

        static::creating(function ($delivery) {
            if (empty($delivery->delivery_number)) {
                $delivery->delivery_number = self::generateDeliveryNumber($delivery->type);
            }
        });
    }

    public static function generateDeliveryNumber(string $type): string
    {
        $prefix = $type === self::TYPE_OUT ? 'SJK' : 'SJM'; // SJ Keluar / SJ Masuk
        $date = now()->format('Ymd');
        $lastDelivery = self::where('type', $type)
            ->whereDate('created_at', today())
            ->latest()
            ->first();
        $sequence = $lastDelivery ? (int) substr($lastDelivery->delivery_number, -3) + 1 : 1;

        return $prefix . '-' . $date . '-' . str_pad($sequence, 3, '0', STR_PAD_LEFT);
    }

    public function rental(): BelongsTo
    {
        return $this->belongsTo(Rental::class);
    }

    public function checkedBy(): BelongsTo
    {
        return $this->belongsTo(User::class, 'checked_by');
    }

    public function items(): HasMany
    {
        return $this->hasMany(DeliveryItem::class);
    }

    public function allItemsChecked(): bool
    {
        return $this->items()->where('is_checked', false)->count() === 0;
    }

    public function complete(): void
    {
        $this->update(['status' => self::STATUS_COMPLETED]);
    }

    public static function getTypeOptions(): array
    {
        return [
            self::TYPE_OUT => 'Keluar (Check-out)',
            self::TYPE_IN => 'Masuk (Check-in)',
        ];
    }

    public static function getTypeColor(string $type): string
    {
        return match ($type) {
            self::TYPE_OUT => 'warning',
            self::TYPE_IN => 'success',
            default => 'gray',
        };
    }

    public static function getStatusColor(string $status): string
    {
        return match ($status) {
            self::STATUS_DRAFT => 'warning',
            self::STATUS_COMPLETED => 'success',
            default => 'gray',
        };
    }

    public static function getStatusOptions(): array
    {
        return [
            self::STATUS_DRAFT => 'Draft',
            self::STATUS_COMPLETED => 'Completed',
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\DeliveryItem.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class DeliveryItem extends Model
{
    protected $fillable = [
        'delivery_id',
        'rental_item_id',
        'rental_item_kit_id',
        'is_checked',
        'condition',
        'notes',
    ];

    protected $casts = [
        'is_checked' => 'boolean',
    ];

    public function delivery(): BelongsTo
    {
        return $this->belongsTo(Delivery::class);
    }

    public function rentalItem(): BelongsTo
    {
        return $this->belongsTo(RentalItem::class);
    }

    public function rentalItemKit(): BelongsTo
    {
        return $this->belongsTo(RentalItemKit::class);
    }

    public static function getConditionOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
        ];
    }

    public static function getConditionInOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
            'lost' => 'Lost',
            'broken' => 'Broken',
        ];
    }

    public static function getConditionColor(string $condition): string
    {
        return match ($condition) {
            'excellent' => 'success',
            'good' => 'info',
            'fair' => 'warning',
            'poor' => 'danger',
            'lost' => 'danger',
            'broken' => 'danger',
            default => 'gray',
        };
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Discount.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Discount extends Model
{
    protected $fillable = [
        'code',
        'name',
        'description',
        'type',
        'value',
        'min_rental_amount',
        'max_discount_amount',
        'usage_limit',
        'usage_count',
        'per_customer_limit',
        'start_date',
        'end_date',
        'is_active',
    ];

    protected $casts = [
        'value' => 'decimal:2',
        'min_rental_amount' => 'decimal:2',
        'max_discount_amount' => 'decimal:2',
        'start_date' => 'date',
        'end_date' => 'date',
        'is_active' => 'boolean',
    ];

    public const TYPE_PERCENTAGE = 'percentage';
    public const TYPE_FIXED = 'fixed';

    public function rentals(): HasMany
    {
        return $this->hasMany(Rental::class);
    }

    public static function getTypeOptions(): array
    {
        return [
            self::TYPE_PERCENTAGE => 'Percentage (%)',
            self::TYPE_FIXED => 'Fixed Amount (Rp)',
        ];
    }

    public function isValid(): bool
    {
        if (!$this->is_active) return false;
        if ($this->start_date && $this->start_date->isFuture()) return false;
        if ($this->end_date && $this->end_date->isPast()) return false;
        if ($this->usage_limit && $this->usage_count >= $this->usage_limit) return false;
        return true;
    }

    public function canBeUsedBy(Customer $customer): bool
    {
        if (!$this->isValid()) return false;
        
        if ($this->per_customer_limit) {
            $usedCount = Rental::where('customer_id', $customer->id)
                ->where('discount_id', $this->id)
                ->count();
            if ($usedCount >= $this->per_customer_limit) return false;
        }
        
        return true;
    }

    public function calculateDiscount(float $amount): float
    {
        if ($this->min_rental_amount && $amount < $this->min_rental_amount) {
            return 0;
        }

        $discount = $this->type === self::TYPE_PERCENTAGE
            ? ($amount * $this->value / 100)
            : $this->value;

        if ($this->max_discount_amount && $discount > $this->max_discount_amount) {
            $discount = $this->max_discount_amount;
        }

        return round($discount, 2);
    }

    public function incrementUsage(): void
    {
        $this->increment('usage_count');
    }

    public static function findByCode(string $code): ?self
    {
        return self::where('code', strtoupper($code))->first();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\DocumentType.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\HasMany;

class DocumentType extends Model
{
    protected $fillable = [
        'name',
        'code',
        'description',
        'is_required',
        'is_active',
        'sort_order',
    ];

    protected $casts = [
        'is_required' => 'boolean',
        'is_active' => 'boolean',
    ];

    public function customerDocuments(): HasMany
    {
        return $this->hasMany(CustomerDocument::class);
    }

    public static function getRequiredTypes()
    {
        return self::where('is_active', true)
            ->where('is_required', true)
            ->orderBy('sort_order')
            ->get();
    }

    public static function getActiveTypes()
    {
        return self::where('is_active', true)
            ->orderBy('sort_order')
            ->get();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Product.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;
use Illuminate\Support\Str;

class Product extends Model
{
    protected $fillable = [
        'category_id',
        'brand_id',
        'name',
        'slug',
        'description',
        'daily_rate',
        'image',
        'is_active',
    ];

    protected $casts = [
        'daily_rate' => 'decimal:2',
        'is_active' => 'boolean',
    ];

    protected static function boot()
    {
        parent::boot();

        static::creating(function ($product) {
            if (empty($product->slug)) {
                $product->slug = Str::slug($product->name);
            }
        });
    }

    // Relasi ke Category
    public function category(): BelongsTo
    {
        return $this->belongsTo(Category::class);
    }

    // Relasi ke Brand
    public function brand(): BelongsTo
    {
        return $this->belongsTo(Brand::class);
    }

    // Relasi ke ProductUnit (akan dibuat nanti)
    public function units(): HasMany
    {
        return $this->hasMany(ProductUnit::class);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\ProductUnit.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class ProductUnit extends Model
{
    protected $fillable = [
        'product_id',
        'serial_number',
        'condition',
        'status',
        'purchase_date',
        'purchase_price',
        'notes',
    ];

    protected $casts = [
        'purchase_date' => 'date',
        'purchase_price' => 'decimal:2',
    ];

    public const STATUS_AVAILABLE = 'available';
    public const STATUS_RENTED = 'rented';
    public const STATUS_MAINTENANCE = 'maintenance';
    public const STATUS_RETIRED = 'retired';

    public function product(): BelongsTo
    {
        return $this->belongsTo(Product::class);
    }

    public function kits(): HasMany
    {
        return $this->hasMany(UnitKit::class, 'unit_id');
    }

    public function rentalItems(): HasMany
    {
        return $this->hasMany(RentalItem::class);
    }

    public function carts(): HasMany
    {
        return $this->hasMany(Cart::class);
    }

    public static function getStatusOptions(): array
    {
        return [
            self::STATUS_AVAILABLE => 'Available',
            self::STATUS_RENTED => 'Rented',
            self::STATUS_MAINTENANCE => 'Maintenance',
            self::STATUS_RETIRED => 'Retired',
        ];
    }

    public static function getStatusColor(string $status): string
    {
        return match ($status) {
            self::STATUS_AVAILABLE => 'success',
            self::STATUS_RENTED => 'warning',
            self::STATUS_MAINTENANCE => 'info',
            self::STATUS_RETIRED => 'danger',
            default => 'gray',
        };
    }

    public static function getConditionOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Rental.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class Rental extends Model
{
    protected $fillable = [
        'rental_code',
        'customer_id',
        'discount_id',
        'discount_code',
        'start_date',
        'end_date',
        'status',
        'subtotal',
        'discount',
        'total',
        'deposit',
        'notes',
    ];

    protected $casts = [
        'start_date' => 'datetime',
        'end_date' => 'datetime',
        'subtotal' => 'decimal:2',
        'discount' => 'decimal:2',
        'total' => 'decimal:2',
        'deposit' => 'decimal:2',
    ];

    public const STATUS_PENDING = 'pending';
    public const STATUS_ACTIVE = 'active';
    public const STATUS_COMPLETED = 'completed';
    public const STATUS_CANCELLED = 'cancelled';
    public const STATUS_LATE_PICKUP = 'late_pickup';
    public const STATUS_LATE_RETURN = 'late_return';

    protected static function boot()
    {
        parent::boot();
        static::creating(function ($rental) {
            if (empty($rental->rental_code)) {
                $rental->rental_code = self::generateRentalCode();
            }
        });
    }

    public static function generateRentalCode(): string
    {
        $prefix = 'RNT';
        $date = now()->format('Ymd');
        $lastRental = self::whereDate('created_at', today())->latest()->first();
        $sequence = $lastRental ? intval(substr($lastRental->rental_code, -4)) + 1 : 1;
        return $prefix . $date . str_pad($sequence, 4, '0', STR_PAD_LEFT);
    }

    public function customer(): BelongsTo
    {
        return $this->belongsTo(Customer::class);
    }

    public function discountRelation(): BelongsTo
    {
        return $this->belongsTo(Discount::class, 'discount_id');
    }

    public function items(): HasMany
    {
        return $this->hasMany(RentalItem::class);
    }

    public function deliveries(): HasMany
    {
        return $this->hasMany(Delivery::class);
    }

    public static function getStatusOptions(): array
    {
        return [
            self::STATUS_PENDING => 'Pending',
            self::STATUS_ACTIVE => 'Active',
            self::STATUS_COMPLETED => 'Completed',
            self::STATUS_CANCELLED => 'Cancelled',
            self::STATUS_LATE_PICKUP => 'Late Pickup',
            self::STATUS_LATE_RETURN => 'Late Return',
        ];
    }

    public static function getStatusColor(string $status): string
    {
        return match ($status) {
            self::STATUS_PENDING => 'warning',
            self::STATUS_ACTIVE => 'success',
            self::STATUS_COMPLETED => 'info',
            self::STATUS_CANCELLED => 'gray',
            self::STATUS_LATE_PICKUP, self::STATUS_LATE_RETURN => 'danger',
            default => 'gray',
        };
    }

    /**
     * Check if the rental can be edited
     */
    public function canBeEdited(): bool
    {
        return in_array($this->status, [
            self::STATUS_PENDING,
            self::STATUS_LATE_PICKUP,
        ]);
    }

    /**
     * Get the real-time status of the rental
     */
    public function getRealTimeStatus(): string
    {
        if (in_array($this->status, [self::STATUS_COMPLETED, self::STATUS_CANCELLED])) {
            return $this->status;
        }

        $now = now();

        if ($this->status === self::STATUS_PENDING && $this->start_date < $now) {
            return self::STATUS_LATE_PICKUP;
        }

        if ($this->status === self::STATUS_ACTIVE && $this->end_date < $now) {
            return self::STATUS_LATE_RETURN;
        }

        return $this->status;
    }

    /**
     * Check and update late status in database
     */
    public function checkAndUpdateLateStatus(): void
    {
        if (in_array($this->status, [self::STATUS_COMPLETED, self::STATUS_CANCELLED])) {
            return;
        }

        $now = now();

        if ($this->status === self::STATUS_PENDING && $this->start_date < $now) {
            $this->update(['status' => self::STATUS_LATE_PICKUP]);
        }

        if ($this->status === self::STATUS_ACTIVE && $this->end_date < $now) {
            $this->update(['status' => self::STATUS_LATE_RETURN]);
        }
    }

    /**
     * Check availability of rental items (conflicts with other active rentals)
     */
    public function checkAvailability(): array
    {
        $conflicts = [];

        foreach ($this->items as $item) {
            // Check if the product unit is already rented in an overlapping period
            $conflictingRentals = self::where('id', '!=', $this->id)
                ->whereIn('status', [self::STATUS_PENDING, self::STATUS_ACTIVE, self::STATUS_LATE_PICKUP, self::STATUS_LATE_RETURN])
                ->where(function ($query) {
                    $query->whereBetween('start_date', [$this->start_date, $this->end_date])
                        ->orWhereBetween('end_date', [$this->start_date, $this->end_date])
                        ->orWhere(function ($q) {
                            $q->where('start_date', '<=', $this->start_date)
                              ->where('end_date', '>=', $this->end_date);
                        });
                })
                ->whereHas('items', function ($query) use ($item) {
                    $query->where('product_unit_id', $item->product_unit_id);
                })
                ->with('customer')
                ->get();

            if ($conflictingRentals->isNotEmpty()) {
                $conflicts[] = [
                    'product_unit' => $item->productUnit,
                    'conflicting_rentals' => $conflictingRentals,
                ];
            }
        }

        return $conflicts;
    }

    /**
     * Validate pickup and change status to active
     */
    public function validatePickup(): void
    {
        if (!in_array($this->status, [self::STATUS_PENDING, self::STATUS_LATE_PICKUP])) {
            throw new \Exception('Cannot validate pickup for this rental status.');
        }

        // Check if all items with kits have their kits checked
        foreach ($this->items as $item) {
            if ($item->productUnit->kits->count() > 0) {
                $checkedKits = $item->rentalItemKits->count();
                $totalKits = $item->productUnit->kits->count();
                
                if ($checkedKits < $totalKits) {
                    throw new \Exception('All kit items must be checked before validating pickup.');
                }
            }
        }

        $this->update(['status' => self::STATUS_ACTIVE]);
    }

    /**
     * Check if the rental can be deleted
     */
    public function canBeDeleted(): bool
    {
        return $this->status === self::STATUS_PENDING;
    }

    public function applyDiscount(Discount $discount): void
    {
        $discountAmount = $discount->calculateDiscount($this->subtotal);
        $this->discount_id = $discount->id;
        $this->discount_code = $discount->code;
        $this->discount = $discountAmount;
        $this->total = $this->subtotal - $discountAmount;
        $this->deposit = $this->total * (Setting::get('deposit_percentage', 30) / 100);
        $this->save();
        $discount->incrementUsage();
    }

    public function removeDiscount(): void
    {
        $this->discount_id = null;
        $this->discount_code = null;
        $this->discount = 0;
        $this->total = $this->subtotal;
        $this->deposit = $this->total * (Setting::get('deposit_percentage', 30) / 100);
        $this->save();
    }

    public function recalculateTotal(): void
    {
        $this->subtotal = $this->items()->sum('subtotal');
        if ($this->discountRelation) {
            $this->discount = $this->discountRelation->calculateDiscount($this->subtotal);
        }
        $this->total = $this->subtotal - $this->discount;
        $this->deposit = $this->total * (Setting::get('deposit_percentage', 30) / 100);
        $this->save();
    }

    public function validateReturn(): void
    {
        $allReturned = $this->items()
            ->whereHas('rentalItemKits', function ($query) {
                $query->where('is_returned', false);
            })->doesntExist();

        if ($allReturned) {
            $this->update(['status' => self::STATUS_COMPLETED]);
        }
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\RentalItem.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;
use Illuminate\Database\Eloquent\Relations\HasMany;

class RentalItem extends Model
{
    protected $fillable = [
        'rental_id',
        'product_unit_id',
        'daily_rate',
        'days',
        'subtotal',
    ];

    protected $casts = [
        'daily_rate' => 'decimal:2',
        'subtotal' => 'decimal:2',
    ];

    public function rental(): BelongsTo
    {
        return $this->belongsTo(Rental::class);
    }

    public function productUnit(): BelongsTo
    {
        return $this->belongsTo(ProductUnit::class);
    }

    public function rentalItemKits(): HasMany
    {
        return $this->hasMany(RentalItemKit::class);
    }

    /**
     * Attach all kits from the product unit to this rental item
     */
    public function attachKitsFromUnit(): void
    {
        $kits = $this->productUnit->kits;

        foreach ($kits as $kit) {
            $this->rentalItemKits()->updateOrCreate(
                ['unit_kit_id' => $kit->id],
                ['condition_out' => $kit->condition]
            );
        }
    }

    /**
     * Check if all kits are returned
     */
    public function allKitsReturned(): bool
    {
        if ($this->rentalItemKits()->count() === 0) {
            return true;
        }
        return $this->rentalItemKits()->where('is_returned', false)->count() === 0;
    }

    /**
     * Get returned kits count
     */
    public function returnedKitsCount(): int
    {
        return $this->rentalItemKits()->where('is_returned', true)->count();
    }

    /**
     * Get total kits count
     */
    public function totalKitsCount(): int
    {
        return $this->rentalItemKits()->count();
    }

    /**
     * Get kits status text
     */
    public function getKitsStatusText(): string
    {
        $total = $this->totalKitsCount();
        if ($total === 0) {
            return 'No kits';
        }
        $returned = $this->returnedKitsCount();
        return "{$returned}/{$total}";
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\RentalItemKit.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class RentalItemKit extends Model
{
    protected $fillable = [
        'rental_item_id',
        'unit_kit_id',
        'condition_out',
        'condition_in',
        'is_returned',
        'notes',
    ];

    protected $casts = [
        'is_returned' => 'boolean',
    ];

    public function rentalItem(): BelongsTo
    {
        return $this->belongsTo(RentalItem::class);
    }

    public function unitKit(): BelongsTo
    {
        return $this->belongsTo(UnitKit::class);
    }

    public static function getConditionColor(string $condition): string
    {
        return match ($condition) {
            'excellent' => 'success',
            'good' => 'info',
            'fair' => 'warning',
            'poor' => 'danger',
            'lost' => 'danger',
            'broken' => 'danger',
            default => 'gray',
        };
    }

    public static function getConditionOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
        ];
    }

    public static function getConditionInOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
            'lost' => 'Lost',
            'broken' => 'Broken',
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\Setting.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\Cache;

class Setting extends Model
{
    protected $fillable = [
        'group',
        'key',
        'value',
        'type',
        'label',
        'description',
        'sort_order',
    ];

    public static function get(string $key, $default = null)
    {
        return Cache::remember("setting.{$key}", 3600, function () use ($key, $default) {
            $setting = self::where('key', $key)->first();
            return $setting ? $setting->value : $default;
        });
    }

    public static function set(string $key, $value): void
    {
        self::updateOrCreate(
            ['key' => $key],
            ['value' => $value]
        );
        Cache::forget("setting.{$key}");
    }

    public static function getGroup(string $group): array
    {
        return self::where('group', $group)
            ->orderBy('sort_order')
            ->get()
            ->pluck('value', 'key')
            ->toArray();
    }

    public static function getAllGrouped(): array
    {
        return self::orderBy('group')
            ->orderBy('sort_order')
            ->get()
            ->groupBy('group')
            ->toArray();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\UnitKit.php
================================================================================

<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\BelongsTo;

class UnitKit extends Model
{
    protected $fillable = [
        'unit_id',
        'name',
        'serial_number',
        'condition',
        'notes',
    ];

    public function productUnit(): BelongsTo
    {
        return $this->belongsTo(ProductUnit::class, 'unit_id');
    }

    // Alias untuk kompatibilitas
    public function unit(): BelongsTo
    {
        return $this->belongsTo(ProductUnit::class, 'unit_id');
    }

    public static function getConditionOptions(): array
    {
        return [
            'excellent' => 'Excellent',
            'good' => 'Good',
            'fair' => 'Fair',
            'poor' => 'Poor',
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Models\User.php
================================================================================

<?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;

class User extends Authenticatable
{
    /** @use HasFactory<\Database\Factories\UserFactory> */
    use HasFactory, Notifiable;

    /**
     * The attributes that are mass assignable.
     *
     * @var list<string>
     */
    protected $fillable = [
        'name',
        'email',
        'password',
    ];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var list<string>
     */
    protected $hidden = [
        'password',
        'remember_token',
    ];

    /**
     * Get the attributes that should be cast.
     *
     * @return array<string, string>
     */
    protected function casts(): array
    {
        return [
            'email_verified_at' => 'datetime',
            'password' => 'hashed',
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Pages\RentalCalendar.php
================================================================================

<?php

namespace App\Filament\Pages;

use BackedEnum;
use App\Filament\Widgets\RentalCalendarWidget;
use Filament\Pages\Page;

class RentalCalendar extends Page
{
    // ikuti signature parent untuk navigationIcon (static, boleh BackedEnum)
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-calendar-days';
    protected static ?string $navigationLabel = 'Rental Calendar';
    protected static ?string $title = 'Rental Calendar';
    protected static ?int $navigationSort = 10;

    // <-- NOTE: view is non-static in the parent Page class, jadi harus non-static di sini
    protected string $view = 'filament.pages.rental-calendar';

    protected function getHeaderWidgets(): array
    {
        return [
            RentalCalendarWidget::class,
        ];
    }

    public function getHeaderWidgetsColumns(): int|array
    {
        return 1;
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Pages\Settings.php
================================================================================

<?php

namespace App\Filament\Pages;

use App\Models\Setting;
use BackedEnum;
use Filament\Actions\Action;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Concerns\InteractsWithForms;
use Filament\Forms\Contracts\HasForms;
use Filament\Notifications\Notification;
use Filament\Pages\Page;
use Filament\Schemas\Schema;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Components\Grid;
use Filament\Schemas\Components\Tabs;
use UnitEnum;

class Settings extends Page implements HasForms
{
    use InteractsWithForms;

    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-cog-6-tooth';

    protected static string|UnitEnum|null $navigationGroup = 'System';

    protected static ?string $navigationLabel = 'Settings';

    protected static ?int $navigationSort = 100;

    protected string $view = 'filament.pages.settings';

    public ?array $data = [];

    public function mount(): void
    {
        $settings = Setting::all()->pluck('value', 'key')->toArray();
        $this->form->fill($settings);
    }

    public function form(Schema $schema): Schema
    {
        return $schema
            ->statePath('data')
            ->components([
                Tabs::make('Settings')
                    ->tabs([
                        Tabs\Tab::make('General')
                            ->icon('heroicon-o-building-office')
                            ->schema([
                                Grid::make(2)
                                    ->schema([
                                        TextInput::make('site_name')
                                            ->label('Site Name')
                                            ->required()
                                            ->maxLength(255),
                                        TextInput::make('site_tagline')
                                            ->label('Tagline')
                                            ->maxLength(255),
                                        TextInput::make('site_email')
                                            ->label('Email')
                                            ->email()
                                            ->maxLength(255),
                                        TextInput::make('site_phone')
                                            ->label('Phone')
                                            ->tel()
                                            ->maxLength(20),
                                    ]),
                                Textarea::make('site_address')
                                    ->label('Address')
                                    ->rows(3)
                                    ->maxLength(500)
                                    ->columnSpanFull(),
                            ]),

                        Tabs\Tab::make('Rental')
                            ->icon('heroicon-o-calendar')
                            ->schema([
                                Grid::make(2)
                                    ->schema([
                                        TextInput::make('deposit_percentage')
                                            ->label('Deposit Percentage')
                                            ->numeric()
                                            ->suffix('%')
                                            ->required()
                                            ->default(30)
                                            ->minValue(0)
                                            ->maxValue(100),
                                        TextInput::make('late_fee_percentage')
                                            ->label('Late Fee per Day')
                                            ->numeric()
                                            ->suffix('%')
                                            ->default(0)
                                            ->minValue(0),
                                        TextInput::make('min_rental_days')
                                            ->label('Minimum Rental Days')
                                            ->numeric()
                                            ->minValue(1)
                                            ->default(1),
                                        TextInput::make('max_rental_days')
                                            ->label('Maximum Rental Days')
                                            ->numeric()
                                            ->minValue(1)
                                            ->default(30),
                                    ]),
                            ]),

                        Tabs\Tab::make('WhatsApp')
                            ->icon('heroicon-o-chat-bubble-left-right')
                            ->schema([
                                TextInput::make('whatsapp_number')
                                    ->label('WhatsApp Number')
                                    ->placeholder('6281234567890')
                                    ->helperText('Format: country code + number (without + or spaces)')
                                    ->maxLength(20),
                                Checkbox::make('whatsapp_enabled')
                                    ->label('Enable WhatsApp Notifications')
                                    ->helperText('Send rental notifications via WhatsApp'),
                            ]),
                    ]),
            ]);
    }

    public function save(): void
    {
        $data = $this->form->getState();

        foreach ($data as $key => $value) {
            Setting::set($key, $value ?? '');
        }

        Notification::make()
            ->title('Settings saved successfully')
            ->success()
            ->send();
    }

    protected function getFormActions(): array
    {
        return [
            Action::make('save')
                ->label('Save Settings')
                ->icon('heroicon-o-check')
                ->submit('save'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\BrandResource.php
================================================================================

<?php

namespace App\Filament\Resources\Brands;

use App\Filament\Resources\Brands\Pages\CreateBrand;
use App\Filament\Resources\Brands\Pages\EditBrand;
use App\Filament\Resources\Brands\Pages\ListBrands;
use App\Filament\Resources\Brands\Schemas\BrandForm;
use App\Filament\Resources\Brands\Tables\BrandsTable;
use App\Models\Brand;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class BrandResource extends Resource
{
    protected static ?string $model = Brand::class;

    protected static ?string $recordTitleAttribute = 'name';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-tag';
    
    protected static string|UnitEnum|null $navigationGroup = 'Inventory';
    
    protected static ?int $navigationSort = 1;
    
    protected static ?string $navigationLabel = 'Brands';

    public static function form(Schema $schema): Schema
    {
        return BrandForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return BrandsTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            //
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListBrands::route('/'),
            'create' => CreateBrand::route('/create'),
            'edit' => EditBrand::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\Pages\CreateBrand.php
================================================================================

<?php

namespace App\Filament\Resources\Brands\Pages;

use App\Filament\Resources\Brands\BrandResource;
use Filament\Resources\Pages\CreateRecord;

class CreateBrand extends CreateRecord
{
    protected static string $resource = BrandResource::class;
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\Pages\EditBrand.php
================================================================================

<?php

namespace App\Filament\Resources\Brands\Pages;

use App\Filament\Resources\Brands\BrandResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditBrand extends EditRecord
{
    protected static string $resource = BrandResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\Pages\ListBrands.php
================================================================================

<?php

namespace App\Filament\Resources\Brands\Pages;

use App\Filament\Resources\Brands\BrandResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListBrands extends ListRecords
{
    protected static string $resource = BrandResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\Schemas\BrandForm.php
================================================================================

<?php

namespace App\Filament\Resources\Brands\Schemas;

use Filament\Forms\Components\FileUpload;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\Toggle;
use Filament\Schemas\Schema;
use Illuminate\Support\Str;

class BrandForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                TextInput::make('name')
                    ->required()
                    ->maxLength(255)
                    ->live(onBlur: true)
                    ->afterStateUpdated(function (string $state, callable $set) {
                        $set('slug', Str::slug($state));
                    }),

                TextInput::make('slug')
                    ->required()
                    ->maxLength(255)
                    ->unique(ignoreRecord: true),

                FileUpload::make('logo')
                    ->image()
                    ->directory('brands'),

                TextInput::make('website')
                    ->url()
                    ->default(null)
                    ->placeholder('https://www.sony.com'),

                Toggle::make('is_active')
                    ->default(true),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Brands\Tables\BrandsTable.php
================================================================================

<?php

namespace App\Filament\Resources\Brands\Tables;

use Filament\Actions\BulkActionGroup;
use Filament\Actions\DeleteAction;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\ImageColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;

class BrandsTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                ImageColumn::make('logo')
                    ->circular(),

                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('slug')
                    ->searchable()
                    ->toggleable(isToggledHiddenByDefault: true),

                TextColumn::make('website')
                    ->toggleable(),

                IconColumn::make('is_active')
                    ->boolean(),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\CategoryResource.php
================================================================================

<?php

namespace App\Filament\Resources\Categories;

use App\Filament\Resources\Categories\Pages\CreateCategory;
use App\Filament\Resources\Categories\Pages\EditCategory;
use App\Filament\Resources\Categories\Pages\ListCategories;
use App\Filament\Resources\Categories\Schemas\CategoryForm;
use App\Filament\Resources\Categories\Tables\CategoriesTable;
use App\Models\Category;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class CategoryResource extends Resource
{
    protected static ?string $model = Category::class;

    protected static ?string $recordTitleAttribute = 'name';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-folder';
    
    protected static string|UnitEnum|null $navigationGroup = 'Inventory';
    
    protected static ?int $navigationSort = 2;
    
    protected static ?string $navigationLabel = 'Categories';

    public static function form(Schema $schema): Schema
    {
        return CategoryForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return CategoriesTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            //
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListCategories::route('/'),
            'create' => CreateCategory::route('/create'),
            'edit' => EditCategory::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\Pages\CreateCategory.php
================================================================================

<?php

namespace App\Filament\Resources\Categories\Pages;

use App\Filament\Resources\Categories\CategoryResource;
use Filament\Resources\Pages\CreateRecord;

class CreateCategory extends CreateRecord
{
    protected static string $resource = CategoryResource::class;
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\Pages\EditCategory.php
================================================================================

<?php

namespace App\Filament\Resources\Categories\Pages;

use App\Filament\Resources\Categories\CategoryResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditCategory extends EditRecord
{
    protected static string $resource = CategoryResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\Pages\ListCategories.php
================================================================================

<?php

namespace App\Filament\Resources\Categories\Pages;

use App\Filament\Resources\Categories\CategoryResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListCategories extends ListRecords
{
    protected static string $resource = CategoryResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\Schemas\CategoryForm.php
================================================================================

<?php

namespace App\Filament\Resources\Categories\Schemas;

use Filament\Forms\Components\FileUpload;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\Toggle;
use Filament\Schemas\Schema;
use Illuminate\Support\Str;

class CategoryForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                TextInput::make('name')
                    ->required()
                    ->maxLength(255)
                    ->live(onBlur: true)
                    ->afterStateUpdated(function (string $state, callable $set) {
                        $set('slug', Str::slug($state));
                    }),

                TextInput::make('slug')
                    ->required()
                    ->maxLength(255)
                    ->unique(ignoreRecord: true),

                Textarea::make('description')
                    ->rows(3)
                    ->default(null),

                FileUpload::make('image')
                    ->image()
                    ->directory('categories'),

                Toggle::make('is_active')
                    ->default(true),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Categories\Tables\CategoriesTable.php
================================================================================

<?php

namespace App\Filament\Resources\Categories\Tables;

use Filament\Actions\BulkActionGroup;
use Filament\Actions\DeleteAction;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\ImageColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;

class CategoriesTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                ImageColumn::make('image')
                    ->circular(),

                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('slug')
                    ->searchable()
                    ->toggleable(isToggledHiddenByDefault: true),

                TextColumn::make('description')
                    ->limit(50)
                    ->toggleable(),

                IconColumn::make('is_active')
                    ->boolean(),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\CustomerResource.php
================================================================================

<?php

namespace App\Filament\Resources\Customers;

use App\Filament\Resources\Customers\Pages\CreateCustomer;
use App\Filament\Resources\Customers\Pages\EditCustomer;
use App\Filament\Resources\Customers\Pages\ListCustomers;
use App\Filament\Resources\Customers\Pages\ViewCustomer;
use App\Filament\Resources\Customers\RelationManagers\DocumentsRelationManager;
use App\Filament\Resources\Customers\Schemas\CustomerForm;
use App\Filament\Resources\Customers\Tables\CustomersTable;
use App\Models\Customer;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class CustomerResource extends Resource
{
    protected static ?string $model = Customer::class;

    protected static ?string $recordTitleAttribute = 'name';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-user-group';
    
    protected static string|UnitEnum|null $navigationGroup = 'Customers';
    
    protected static ?int $navigationSort = 1;
    
    protected static ?string $navigationLabel = 'Customers';

    public static function form(Schema $schema): Schema
    {
        return CustomerForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return CustomersTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            DocumentsRelationManager::class,
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListCustomers::route('/'),
            'create' => CreateCustomer::route('/create'),
            'view' => ViewCustomer::route('/{record}'),
            'edit' => EditCustomer::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Pages\CreateCustomer.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Pages;

use App\Filament\Resources\Customers\CustomerResource;
use Filament\Resources\Pages\CreateRecord;

class CreateCustomer extends CreateRecord
{
    protected static string $resource = CustomerResource::class;
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Pages\EditCustomer.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Pages;

use App\Filament\Resources\Customers\CustomerResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditCustomer extends EditRecord
{
    protected static string $resource = CustomerResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Pages\ListCustomers.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Pages;

use App\Filament\Resources\Customers\CustomerResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListCustomers extends ListRecords
{
    protected static string $resource = CustomerResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Pages\ViewCustomer.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Pages;

use App\Filament\Resources\Customers\CustomerResource;
use App\Models\CustomerDocument;
use Filament\Actions\Action;
use Filament\Actions\EditAction;
use Filament\Notifications\Notification;
use Filament\Resources\Pages\ViewRecord;
use Illuminate\Support\Facades\Auth;

class ViewCustomer extends ViewRecord
{
    protected static string $resource = CustomerResource::class;

    protected function getHeaderActions(): array
    {
        return [
            Action::make('verify')
                ->label('Verify Customer')
                ->icon('heroicon-o-check-badge')
                ->color('success')
                ->requiresConfirmation()
                ->modalHeading('Verify Customer')
                ->modalDescription('Are you sure you want to verify this customer? This will allow them to make rentals.')
                ->visible(fn () => !$this->record->is_verified && $this->record->getVerificationStatus() !== 'not_verified')
                ->action(function () {
                    $this->record->documents()
                        ->where('status', CustomerDocument::STATUS_PENDING)
                        ->update([
                            'status' => CustomerDocument::STATUS_APPROVED,
                            'verified_by' => Auth::id(),
                            'verified_at' => now(),
                        ]);

                    $this->record->verify(Auth::id());

                    Notification::make()
                        ->title('Customer verified successfully')
                        ->success()
                        ->send();
                }),

            Action::make('unverify')
                ->label('Revoke Verification')
                ->icon('heroicon-o-x-circle')
                ->color('danger')
                ->requiresConfirmation()
                ->modalHeading('Revoke Verification')
                ->modalDescription('Are you sure you want to revoke this customer\'s verification?')
                ->visible(fn () => $this->record->is_verified)
                ->action(function () {
                    $this->record->unverify();

                    Notification::make()
                        ->title('Verification revoked')
                        ->success()
                        ->send();
                }),

            EditAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\RelationManagers\DocumentsRelationManager.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\RelationManagers;

use App\Models\CustomerDocument;
use Filament\Actions\Action;
use Filament\Actions\DeleteAction;
use Filament\Forms\Components\Textarea;
use Filament\Notifications\Notification;
use Filament\Resources\RelationManagers\RelationManager;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Storage;

class DocumentsRelationManager extends RelationManager
{
    protected static string $relationship = 'documents';

    protected static ?string $title = 'Documents';

    public function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('documentType.name')
                    ->label('Document Type'),

                TextColumn::make('file_name')
                    ->label('File')
                    ->limit(30),

                TextColumn::make('file_size')
                    ->label('Size')
                    ->formatStateUsing(fn ($state) => number_format($state / 1024, 1) . ' KB'),

                TextColumn::make('status')
                    ->badge()
                    ->color(fn (string $state) => CustomerDocument::getStatusColor($state)),

                TextColumn::make('verifiedBy.name')
                    ->label('Verified By'),

                TextColumn::make('verified_at')
                    ->label('Verified At')
                    ->dateTime(),
            ])
            ->recordActions([
                Action::make('view')
                    ->label('View')
                    ->icon('heroicon-o-eye')
                    ->url(fn (CustomerDocument $record) => Storage::url($record->file_path))
                    ->openUrlInNewTab(),

                Action::make('approve')
                    ->label('Approve')
                    ->icon('heroicon-o-check')
                    ->color('success')
                    ->requiresConfirmation()
                    ->visible(fn (CustomerDocument $record) => $record->status === CustomerDocument::STATUS_PENDING)
                    ->action(function (CustomerDocument $record) {
                        $record->approve(Auth::id());

                        $customer = $record->customer;
                        $this->checkAndVerifyCustomer($customer);

                        Notification::make()
                            ->title('Document approved')
                            ->success()
                            ->send();
                    }),

                Action::make('reject')
                    ->label('Reject')
                    ->icon('heroicon-o-x-mark')
                    ->color('danger')
                    ->form([
                        Textarea::make('rejection_reason')
                            ->label('Reason')
                            ->required()
                            ->rows(3),
                    ])
                    ->visible(fn (CustomerDocument $record) => $record->status === CustomerDocument::STATUS_PENDING)
                    ->action(function (CustomerDocument $record, array $data) {
                        $record->reject(Auth::id(), $data['rejection_reason']);

                        Notification::make()
                            ->title('Document rejected')
                            ->success()
                            ->send();
                    }),

                DeleteAction::make(),
            ]);
    }

    protected function checkAndVerifyCustomer($customer): void
    {
        $requiredTypes = \App\Models\DocumentType::getRequiredTypes();
        $allApproved = true;

        foreach ($requiredTypes as $type) {
            $doc = $customer->documents()->where('document_type_id', $type->id)->first();
            if (!$doc || $doc->status !== CustomerDocument::STATUS_APPROVED) {
                $allApproved = false;
                break;
            }
        }

        if ($allApproved && !$customer->is_verified) {
            $customer->verify(Auth::id());
        }
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Schemas\CustomerForm.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Schemas;

use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;

class CustomerForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Section::make('Customer Information')
                    ->schema([
                        TextInput::make('name')
                            ->required()
                            ->maxLength(255),

                        TextInput::make('email')
                            ->email()
                            ->required()
                            ->unique(ignoreRecord: true)
                            ->maxLength(255),

                        TextInput::make('phone')
                            ->tel()
                            ->maxLength(20),

                        TextInput::make('nik')
                            ->label('NIK (No. KTP)')
                            ->maxLength(16)
                            ->minLength(16),

                        Textarea::make('address')
                            ->rows(3)
                            ->columnSpanFull(),
                    ])
                    ->columns(2),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Customers\Tables\CustomersTable.php
================================================================================

<?php

namespace App\Filament\Resources\Customers\Tables;

use App\Models\Customer;
use Filament\Actions\BulkActionGroup;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Actions\ViewAction;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Filters\SelectFilter;
use Filament\Tables\Table;

class CustomersTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('email')
                    ->label('Email')
                    ->searchable(),

                TextColumn::make('phone')
                    ->searchable(),

                TextColumn::make('nik')
                    ->label('NIK')
                    ->searchable(),

                TextColumn::make('verification_status')
                    ->label('Verification')
                    ->badge()
                    ->getStateUsing(fn (Customer $record) => $record->getVerificationStatus())
                    ->color(fn (string $state) => match ($state) {
                        'verified' => 'success',
                        'pending' => 'warning',
                        'not_verified' => 'danger',
                    })
                    ->formatStateUsing(fn (string $state) => match ($state) {
                        'verified' => 'Verified',
                        'pending' => 'Pending',
                        'not_verified' => 'Not Verified',
                    }),

                TextColumn::make('rentals_count')
                    ->label('Rentals')
                    ->counts('rentals'),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                SelectFilter::make('is_verified')
                    ->label('Verification Status')
                    ->options([
                        '1' => 'Verified',
                        '0' => 'Not Verified',
                    ]),
            ])
            ->recordActions([
                ViewAction::make(),
                EditAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\DeliveryResource.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries;

use App\Filament\Resources\Deliveries\Pages\CreateDelivery;
use App\Filament\Resources\Deliveries\Pages\EditDelivery;
use App\Filament\Resources\Deliveries\Pages\ListDeliveries;
use App\Filament\Resources\Deliveries\Pages\ProcessDelivery;
use App\Filament\Resources\Deliveries\Schemas\DeliveryForm;
use App\Filament\Resources\Deliveries\Tables\DeliveriesTable;
use App\Models\Delivery;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class DeliveryResource extends Resource
{
    protected static ?string $model = Delivery::class;

    protected static ?string $recordTitleAttribute = 'delivery_number';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-truck';
    
    protected static string|UnitEnum|null $navigationGroup = 'Operations';
    
    protected static ?int $navigationSort = 1;
    
    protected static ?string $navigationLabel = 'Deliveries';

    public static function form(Schema $schema): Schema
    {
        return DeliveryForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return DeliveriesTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListDeliveries::route('/'),
            'create' => CreateDelivery::route('/create'),
            'edit' => EditDelivery::route('/{record}/edit'),
            'process' => ProcessDelivery::route('/{record}/process'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Pages\CreateDelivery.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Pages;

use App\Filament\Resources\Deliveries\DeliveryResource;
use Filament\Resources\Pages\CreateRecord;

class CreateDelivery extends CreateRecord
{
    protected static string $resource = DeliveryResource::class;

    protected function afterCreate(): void
    {
        $delivery = $this->record;
        $rental = $delivery->rental;

        // Auto-create delivery items from rental items
        foreach ($rental->items as $rentalItem) {
            // Create item for the product unit
            $delivery->items()->create([
                'rental_item_id' => $rentalItem->getKey(),
                'rental_item_kit_id' => null,
                'is_checked' => false,
            ]);

            // Create items for each kit
            foreach ($rentalItem->rentalItemKits as $kit) {
                $delivery->items()->create([
                    'rental_item_id' => $rentalItem->getKey(),
                    'rental_item_kit_id' => $kit->getKey(),
                    'is_checked' => false,
                ]);
            }
        }
    }

    protected function getRedirectUrl(): string
    {
        return DeliveryResource::getUrl('process', ['record' => $this->record]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Pages\EditDelivery.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Pages;

use App\Filament\Resources\Deliveries\DeliveryResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditDelivery extends EditRecord
{
    protected static string $resource = DeliveryResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Pages\ListDeliveries.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Pages;

use App\Filament\Resources\Deliveries\DeliveryResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListDeliveries extends ListRecords
{
    protected static string $resource = DeliveryResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Pages\ProcessDelivery.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Pages;

use App\Filament\Resources\Deliveries\DeliveryResource;
use App\Models\Delivery;
use App\Models\DeliveryItem;
use Barryvdh\DomPDF\Facade\Pdf;
use Filament\Actions\Action;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Notifications\Notification;
use Filament\Resources\Pages\Page;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Concerns\InteractsWithTable;
use Filament\Tables\Contracts\HasTable;
use Filament\Tables\Table;
use Illuminate\Contracts\Support\Htmlable;

class ProcessDelivery extends Page implements HasTable
{
    use InteractsWithTable;

    protected static string $resource = DeliveryResource::class;

    public ?Delivery $delivery = null;

    public function getView(): string
    {
        return 'filament.resources.deliveries.pages.process-delivery';
    }

    public function mount(int|string $record): void
    {
        $this->delivery = Delivery::with([
            'rental.customer',
            'rental.items.productUnit.product',
            'rental.items.rentalItemKits.unitKit',
            'items.rentalItem.productUnit.product',
            'items.rentalItemKit.unitKit',
            'checkedBy',
        ])->findOrFail($record);
    }

    public function getTitle(): string|Htmlable
    {
        $type = $this->delivery->type === 'out' ? 'Check-out' : 'Check-in';
        return $type . ' - ' . $this->delivery->delivery_number;
    }

    public function table(Table $table): Table
    {
        return $table
            ->query($this->delivery->items()->getQuery())
            ->columns([
                TextColumn::make('item_name')
                    ->label('Item')
                    ->getStateUsing(function (DeliveryItem $record) {
                        if ($record->rentalItemKit) {
                            return ' ' . $record->rentalItemKit->unitKit->name;
                        }
                        return $record->rentalItem->productUnit->product->name;
                    }),

                TextColumn::make('serial_number')
                    ->label('Serial Number')
                    ->getStateUsing(function (DeliveryItem $record) {
                        if ($record->rentalItemKit) {
                            return $record->rentalItemKit->unitKit->serial_number ?? '-';
                        }
                        return $record->rentalItem->productUnit->serial_number;
                    }),

                TextColumn::make('type')
                    ->label('Type')
                    ->getStateUsing(function (DeliveryItem $record) {
                        return $record->rentalItemKit ? 'Kit' : 'Unit';
                    })
                    ->badge()
                    ->color(fn (string $state) => $state === 'Unit' ? 'primary' : 'gray'),

                TextColumn::make('condition')
                    ->label('Condition')
                    ->badge()
                    ->color(fn (?string $state) => $state ? DeliveryItem::getConditionColor($state) : 'gray')
                    ->formatStateUsing(fn (?string $state) => $state ? ucfirst($state) : '-'),

                IconColumn::make('is_checked')
                    ->label('Checked')
                    ->boolean()
                    ->trueIcon('heroicon-o-check-circle')
                    ->falseIcon('heroicon-o-x-circle')
                    ->trueColor('success')
                    ->falseColor('danger'),
            ])
            ->recordActions([
                \Filament\Actions\Action::make('check_item')
                    ->label(fn (DeliveryItem $record) => $record->is_checked ? 'Edit' : 'Check')
                    ->icon(fn (DeliveryItem $record) => $record->is_checked ? 'heroicon-o-pencil' : 'heroicon-o-check')
                    ->color(fn (DeliveryItem $record) => $record->is_checked ? 'gray' : 'warning')
                    ->modalHeading('Check Item')
                    ->modalWidth('md')
                    ->fillForm(function (DeliveryItem $record): array {
                        return [
                            'item_name' => $record->rentalItemKit 
                                ? $record->rentalItemKit->unitKit->name 
                                : $record->rentalItem->productUnit->product->name,
                            'condition' => $record->condition,
                            'is_checked' => $record->is_checked,
                            'notes' => $record->notes,
                        ];
                    })
                    ->form(function (DeliveryItem $record) {
                        $conditionOptions = $this->delivery->type === 'out' 
                            ? DeliveryItem::getConditionOptions() 
                            : DeliveryItem::getConditionInOptions();

                        return [
                            TextInput::make('item_name')
                                ->label('Item')
                                ->disabled()
                                ->dehydrated(false),

                            Select::make('condition')
                                ->label('Condition')
                                ->options($conditionOptions)
                                ->required(),

                            Checkbox::make('is_checked')
                                ->label('Mark as Checked'),

                            Textarea::make('notes')
                                ->label('Notes')
                                ->rows(2),
                        ];
                    })
                    ->action(function (DeliveryItem $record, array $data) {
                        $record->update([
                            'condition' => $data['condition'],
                            'is_checked' => $data['is_checked'],
                            'notes' => $data['notes'],
                        ]);

                        if ($this->delivery->type === 'out' && $record->rentalItemKit) {
                            $record->rentalItemKit->update(['condition_out' => $data['condition']]);
                        }

                        if ($this->delivery->type === 'in' && $record->rentalItemKit) {
                            $record->rentalItemKit->update([
                                'condition_in' => $data['condition'],
                                'is_returned' => $data['is_checked'],
                            ]);
                        }

                        $this->delivery->refresh();

                        Notification::make()
                            ->title('Item updated')
                            ->success()
                            ->send();
                    })
                    ->visible(fn () => $this->delivery->status === Delivery::STATUS_DRAFT),
            ])
            ->headerActions([])
            ->paginated(false);
    }

    public function allItemsChecked(): bool
    {
        return $this->delivery->items()->where('is_checked', false)->count() === 0;
    }

    protected function getHeaderActions(): array
    {
        return [
            Action::make('download_pdf')
                ->label('Download PDF')
                ->icon('heroicon-o-document-arrow-down')
                ->color('info')
                ->action(function () {
                    $this->delivery->load(['rental.customer', 'items.rentalItem.productUnit.product', 'items.rentalItemKit.unitKit', 'checkedBy']);
                    
                    $pdf = Pdf::loadView('pdf.delivery-note', ['delivery' => $this->delivery]);
                    
                    return response()->streamDownload(
                        fn () => print($pdf->output()),
                        $this->delivery->delivery_number . '.pdf'
                    );
                }),

            $this->getCompleteAction(),
        ];
    }

    public function getCompleteAction(): Action
    {
        return Action::make('complete')
            ->label('Complete Delivery')
            ->icon('heroicon-o-check-circle')
            ->color('success')
            ->size('lg')
            ->requiresConfirmation()
            ->modalHeading('Complete Delivery')
            ->modalDescription('Are you sure all items have been checked? This will mark the delivery as completed.')
            ->modalSubmitActionLabel('Yes, Complete')
            ->disabled(fn () => !$this->allItemsChecked() || $this->delivery->status === Delivery::STATUS_COMPLETED)
            ->action(function () {
                $this->delivery->complete();

                if ($this->delivery->type === 'out') {
                    $this->delivery->rental->update(['status' => 'active']);
                } elseif ($this->delivery->type === 'in') {
                    $this->delivery->rental->validateReturn();
                }

                Notification::make()
                    ->title('Delivery completed')
                    ->success()
                    ->send();

                $this->redirect(DeliveryResource::getUrl('index'));
            });
    }

    public function completeAction(): Action
    {
        return $this->getCompleteAction();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Schemas\DeliveryForm.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Schemas;

use App\Models\Delivery;
use Filament\Forms\Components\DatePicker;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;
use Illuminate\Support\Facades\Auth;

class DeliveryForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Section::make('Delivery Information')
                    ->schema([
                        TextInput::make('delivery_number')
                            ->label('Delivery Number')
                            ->disabled()
                            ->dehydrated(false)
                            ->placeholder('Auto-generated'),

                        Select::make('rental_id')
                            ->label('Rental')
                            ->relationship('rental', 'rental_code')
                            ->searchable()
                            ->preload()
                            ->required()
                            ->live()
                            ->afterStateUpdated(fn ($state, callable $set) => $set('items', [])),

                        Select::make('type')
                            ->label('Type')
                            ->options(Delivery::getTypeOptions())
                            ->required()
                            ->live(),

                        DatePicker::make('date')
                            ->label('Date')
                            ->default(now())
                            ->required(),

                        Select::make('checked_by')
                            ->label('Checked By')
                            ->relationship('checkedBy', 'name')
                            ->searchable()
                            ->preload()
                            ->default(fn () => Auth::id()),

                        Select::make('status')
                            ->label('Status')
                            ->options(Delivery::getStatusOptions())
                            ->default('draft')
                            ->disabled(),

                        Textarea::make('notes')
                            ->label('Notes')
                            ->rows(3)
                            ->columnSpanFull(),
                    ])
                    ->columns(2),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Deliveries\Tables\DeliveriesTable.php
================================================================================

<?php

namespace App\Filament\Resources\Deliveries\Tables;

use App\Filament\Resources\Deliveries\DeliveryResource;
use App\Models\Delivery;
use Barryvdh\DomPDF\Facade\Pdf;
use Filament\Actions\Action;
use Filament\Actions\DeleteAction;
use Filament\Actions\EditAction;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Filters\SelectFilter;
use Filament\Tables\Table;

class DeliveriesTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('delivery_number')
                    ->label('Delivery Number')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('rental.rental_code')
                    ->label('Rental')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('rental.customer.name')
                    ->label('Customer')
                    ->searchable(),

                TextColumn::make('type')
                    ->badge()
                    ->color(fn (string $state): string => Delivery::getTypeColor($state))
                    ->formatStateUsing(fn (string $state): string => $state === 'out' ? 'Keluar' : 'Masuk'),

                TextColumn::make('date')
                    ->date('d M Y')
                    ->sortable(),

                TextColumn::make('status')
                    ->badge()
                    ->color(fn (string $state): string => Delivery::getStatusColor($state))
                    ->formatStateUsing(fn (string $state): string => ucfirst($state)),

                TextColumn::make('checkedBy.name')
                    ->label('Checked By'),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->defaultSort('created_at', 'desc')
            ->filters([
                SelectFilter::make('type')
                    ->options(Delivery::getTypeOptions()),
                SelectFilter::make('status')
                    ->options(Delivery::getStatusOptions()),
            ])
            ->recordActions([
                Action::make('process')
                    ->label('Process')
                    ->icon('heroicon-o-clipboard-document-check')
                    ->color('warning')
                    ->url(fn (Delivery $record) => DeliveryResource::getUrl('process', ['record' => $record]))
                    ->visible(fn (Delivery $record) => $record->status === Delivery::STATUS_DRAFT),

                Action::make('download_pdf')
                    ->label('Download PDF')
                    ->icon('heroicon-o-document-arrow-down')
                    ->color('info')
                    ->action(function (Delivery $record) {
                        $record->load(['rental.customer', 'rental.items.productUnit.product', 'items.rentalItem.productUnit', 'items.rentalItemKit.unitKit', 'checkedBy']);
                        
                        $pdf = Pdf::loadView('pdf.delivery-note', ['delivery' => $record]);
                        
                        return response()->streamDownload(
                            fn () => print($pdf->output()),
                            $record->delivery_number . '.pdf'
                        );
                    }),

                EditAction::make()
                    ->visible(fn (Delivery $record) => $record->status === Delivery::STATUS_DRAFT),

                DeleteAction::make()
                    ->visible(fn (Delivery $record) => $record->status === Delivery::STATUS_DRAFT),
            ])
            ->recordUrl(fn (Delivery $record) => DeliveryResource::getUrl('process', ['record' => $record]));
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Discounts\DiscountResource.php
================================================================================

<?php

namespace App\Filament\Resources\Discounts;

use App\Models\Discount;
use BackedEnum;
use Filament\Actions\DeleteAction;
use Filament\Actions\EditAction;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\DatePicker;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Resources\Resource;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Filters\SelectFilter;
use Filament\Tables\Table;
use UnitEnum;

class DiscountResource extends Resource
{
    protected static ?string $model = Discount::class;

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-ticket';
    
    protected static string|UnitEnum|null $navigationGroup = 'Sales';
    
    protected static ?int $navigationSort = 1;
    
    protected static ?string $navigationLabel = 'Discounts';

    public static function form(Schema $schema): Schema
    {
        return $schema->components([
            Section::make('Discount Information')
                ->schema([
                    TextInput::make('code')
                        ->required()
                        ->unique(ignoreRecord: true)
                        ->maxLength(50)
                        ->formatStateUsing(fn ($state) => strtoupper($state))
                        ->dehydrateStateUsing(fn ($state) => strtoupper($state)),

                    TextInput::make('name')
                        ->required()
                        ->maxLength(255),

                    Textarea::make('description')
                        ->rows(2)
                        ->columnSpanFull(),

                    Select::make('type')
                        ->options(Discount::getTypeOptions())
                        ->required()
                        ->default('percentage'),

                    TextInput::make('value')
                        ->required()
                        ->numeric()
                        ->minValue(0),
                ])
                ->columns(2),

            Section::make('Limits')
                ->schema([
                    TextInput::make('min_rental_amount')
                        ->label('Minimum Rental Amount')
                        ->numeric()
                        ->prefix('Rp'),

                    TextInput::make('max_discount_amount')
                        ->label('Maximum Discount Amount')
                        ->numeric()
                        ->prefix('Rp'),

                    TextInput::make('usage_limit')
                        ->label('Total Usage Limit')
                        ->numeric()
                        ->minValue(1),

                    TextInput::make('per_customer_limit')
                        ->label('Per Customer Limit')
                        ->numeric()
                        ->minValue(1),
                ])
                ->columns(2),

            Section::make('Validity')
                ->schema([
                    DatePicker::make('start_date'),
                    DatePicker::make('end_date'),
                    Checkbox::make('is_active')
                        ->label('Active')
                        ->default(true),
                ])
                ->columns(3),
        ]);
    }

    public static function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('code')
                    ->badge()
                    ->color('primary')
                    ->searchable(),

                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('type')
                    ->badge()
                    ->color(fn (string $state) => $state === 'percentage' ? 'info' : 'success'),

                TextColumn::make('value')
                    ->formatStateUsing(fn (Discount $record) => $record->type === 'percentage' 
                        ? $record->value . '%' 
                        : 'Rp ' . number_format($record->value, 0, ',', '.')),

                TextColumn::make('usage')
                    ->getStateUsing(fn (Discount $record) => $record->usage_count . ($record->usage_limit ? '/' . $record->usage_limit : '')),

                TextColumn::make('end_date')
                    ->label('Valid Until')
                    ->date()
                    ->color(fn (Discount $record) => $record->end_date?->isPast() ? 'danger' : null),

                IconColumn::make('is_active')
                    ->label('Active')
                    ->boolean(),
            ])
            ->filters([
                SelectFilter::make('type')
                    ->options(Discount::getTypeOptions()),
                SelectFilter::make('is_active')
                    ->options(['1' => 'Active', '0' => 'Inactive']),
            ])
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ]);
    }

    public static function getPages(): array
    {
        return [
            'index' => \App\Filament\Resources\Discounts\Pages\ListDiscounts::route('/'),
            'create' => \App\Filament\Resources\Discounts\Pages\CreateDiscount::route('/create'),
            'edit' => \App\Filament\Resources\Discounts\Pages\EditDiscount::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Discounts\Pages\CreateDiscount.php
================================================================================

<?php

namespace App\Filament\Resources\Discounts\Pages;

use App\Filament\Resources\Discounts\DiscountResource;
use Filament\Resources\Pages\CreateRecord;

class CreateDiscount extends CreateRecord
{
    protected static string $resource = DiscountResource::class;
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Discounts\Pages\EditDiscount.php
================================================================================

<?php

namespace App\Filament\Resources\Discounts\Pages;

use App\Filament\Resources\Discounts\DiscountResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditDiscount extends EditRecord
{
    protected static string $resource = DiscountResource::class;

    protected function getHeaderActions(): array
    {
        return [DeleteAction::make()];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Discounts\Pages\ListDiscounts.php
================================================================================

<?php

namespace App\Filament\Resources\Discounts\Pages;

use App\Filament\Resources\Discounts\DiscountResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListDiscounts extends ListRecords
{
    protected static string $resource = DiscountResource::class;

    protected function getHeaderActions(): array
    {
        return [CreateAction::make()];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\DocumentTypeResource.php
================================================================================

<?php

namespace App\Filament\Resources;

use App\Models\DocumentType;
use BackedEnum;
use Filament\Actions\DeleteAction;
use Filament\Actions\EditAction;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Support\Icons\Heroicon;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;
use UnitEnum;

class DocumentTypeResource extends Resource
{
    protected static ?string $model = DocumentType::class;

    protected static string|BackedEnum|null $navigationIcon = Heroicon::OutlinedDocumentText;

    protected static string|UnitEnum|null $navigationGroup = 'Settings';

    protected static ?int $navigationSort = 10;

    public static function form(Schema $schema): Schema
    {
        return $schema
            ->components([
                TextInput::make('name')
                    ->required()
                    ->maxLength(255),

                TextInput::make('code')
                    ->required()
                    ->unique(ignoreRecord: true)
                    ->maxLength(50),

                Textarea::make('description')
                    ->rows(2),

                TextInput::make('sort_order')
                    ->numeric()
                    ->default(0),

                Checkbox::make('is_required')
                    ->label('Required for verification'),

                Checkbox::make('is_active')
                    ->label('Active')
                    ->default(true),
            ]);
    }

    public static function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('sort_order')
                    ->label('#')
                    ->sortable(),

                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('code')
                    ->badge()
                    ->color('gray'),

                IconColumn::make('is_required')
                    ->label('Required')
                    ->boolean(),

                IconColumn::make('is_active')
                    ->label('Active')
                    ->boolean(),
            ])
            ->defaultSort('sort_order')
            ->reorderable('sort_order')
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ]);
    }

    public static function getPages(): array
    {
        return [
            'index' => \App\Filament\Resources\DocumentTypeResource\Pages\ListDocumentTypes::route('/'),
            'create' => \App\Filament\Resources\DocumentTypeResource\Pages\CreateDocumentType::route('/create'),
            'edit' => \App\Filament\Resources\DocumentTypeResource\Pages\EditDocumentType::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\DocumentTypeResource\Pages\CreateDocumentType.php
================================================================================

<?php

namespace App\Filament\Resources\DocumentTypeResource\Pages;

use App\Filament\Resources\DocumentTypeResource;
use Filament\Resources\Pages\CreateRecord;

class CreateDocumentType extends CreateRecord
{
    protected static string $resource = DocumentTypeResource::class;
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\DocumentTypeResource\Pages\EditDocumentType.php
================================================================================

<?php

namespace App\Filament\Resources\DocumentTypeResource\Pages;

use App\Filament\Resources\DocumentTypeResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditDocumentType extends EditRecord
{
    protected static string $resource = DocumentTypeResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\DocumentTypeResource\Pages\ListDocumentTypes.php
================================================================================

<?php

namespace App\Filament\Resources\DocumentTypeResource\Pages;

use App\Filament\Resources\DocumentTypeResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListDocumentTypes extends ListRecords
{
    protected static string $resource = DocumentTypeResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\Pages\CreateProductUnit.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\Pages;

use App\Filament\Resources\ProductUnits\ProductUnitResource;
use Filament\Resources\Pages\CreateRecord;

class CreateProductUnit extends CreateRecord
{
    protected static string $resource = ProductUnitResource::class;
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\Pages\EditProductUnit.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\Pages;

use App\Filament\Resources\ProductUnits\ProductUnitResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditProductUnit extends EditRecord
{
    protected static string $resource = ProductUnitResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\Pages\ListProductUnits.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\Pages;

use App\Filament\Resources\ProductUnits\ProductUnitResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListProductUnits extends ListRecords
{
    protected static string $resource = ProductUnitResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\ProductUnitResource.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits;

use App\Filament\Resources\ProductUnits\Pages\CreateProductUnit;
use App\Filament\Resources\ProductUnits\Pages\EditProductUnit;
use App\Filament\Resources\ProductUnits\Pages\ListProductUnits;
use App\Filament\Resources\ProductUnits\RelationManagers\KitsRelationManager;
use App\Filament\Resources\ProductUnits\Schemas\ProductUnitForm;
use App\Filament\Resources\ProductUnits\Tables\ProductUnitsTable;
use App\Models\ProductUnit;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class ProductUnitResource extends Resource
{
    protected static ?string $model = ProductUnit::class;

    protected static ?string $recordTitleAttribute = 'serial_number';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-rectangle-stack';
    
    protected static string|UnitEnum|null $navigationGroup = 'Inventory';
    
    protected static ?int $navigationSort = 3;
    
    protected static ?string $navigationLabel = 'Product Units';

    public static function form(Schema $schema): Schema
    {
        return ProductUnitForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return ProductUnitsTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            KitsRelationManager::class,
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListProductUnits::route('/'),
            'create' => CreateProductUnit::route('/create'),
            'edit' => EditProductUnit::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\RelationManagers\KitsRelationManager.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\RelationManagers;

use Filament\Actions\BulkActionGroup;
use Filament\Actions\CreateAction;
use Filament\Actions\DeleteAction;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Resources\RelationManagers\RelationManager;
use Filament\Schemas\Schema;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;

class KitsRelationManager extends RelationManager
{
    protected static string $relationship = 'kits';

    protected static ?string $title = 'Unit Kits';

    protected static ?string $recordTitleAttribute = 'name';

    public function form(Schema $schema): Schema
    {
        return $schema
            ->components([
                TextInput::make('name')
                    ->required()
                    ->maxLength(255)
                    ->placeholder('e.g., Battery, Charger, Strap, Lens Cap'),

                TextInput::make('serial_number')
                    ->maxLength(255)
                    ->placeholder('Optional serial number'),

                Select::make('condition')
                    ->options([
                        'excellent' => 'Excellent',
                        'good' => 'Good',
                        'fair' => 'Fair',
                        'poor' => 'Poor',
                    ])
                    ->default('excellent')
                    ->required(),

                Textarea::make('notes')
                    ->rows(3)
                    ->placeholder('Additional notes about this kit item'),
            ]);
    }

    public function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('name')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('serial_number')
                    ->searchable()
                    ->placeholder(''),

                TextColumn::make('condition')
                    ->badge()
                    ->color(fn (string $state): string => match ($state) {
                        'excellent' => 'success',
                        'good' => 'info',
                        'fair' => 'warning',
                        'poor' => 'danger',
                        default => 'gray',
                    }),

                TextColumn::make('notes')
                    ->limit(30)
                    ->tooltip(fn ($record) => $record->notes)
                    ->placeholder(''),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ])
            ->headerActions([
                CreateAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\Schemas\ProductUnitForm.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\Schemas;

use App\Models\Product;
use Filament\Forms\Components\DatePicker;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Schemas\Schema;

class ProductUnitForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Select::make('product_id')
                    ->label('Product')
                    ->options(Product::where('is_active', true)->pluck('name', 'id'))
                    ->required()
                    ->searchable(),

                TextInput::make('serial_number')
                    ->required()
                    ->maxLength(255)
                    ->unique(ignoreRecord: true)
                    ->placeholder('SN-A7IV-001'),

                Select::make('condition')
                    ->options([
                        'excellent' => 'Excellent',
                        'good' => 'Good',
                        'fair' => 'Fair',
                        'poor' => 'Poor',
                    ])
                    ->required()
                    ->default('excellent'),

                Select::make('status')
                    ->options([
                        'available' => 'Available',
                        'rented' => 'Rented',
                        'maintenance' => 'Maintenance',
                        'retired' => 'Retired',
                    ])
                    ->required()
                    ->default('available'),

                Textarea::make('notes')
                    ->rows(3)
                    ->columnSpanFull(),

                DatePicker::make('purchase_date')
                    ->label('Purchase Date'),

                TextInput::make('purchase_price')
                    ->label('Purchase Price')
                    ->numeric()
                    ->prefix('Rp'),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\ProductUnits\Tables\ProductUnitsTable.php
================================================================================

<?php

namespace App\Filament\Resources\ProductUnits\Tables;

use Filament\Actions\BulkActionGroup;
use Filament\Actions\DeleteAction;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;

class ProductUnitsTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('product.name')
                    ->label('Product')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('serial_number')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('condition')
                    ->badge()
                    ->color(fn (string $state): string => match ($state) {
                        'excellent' => 'success',
                        'good' => 'info',
                        'fair' => 'warning',
                        'poor' => 'danger',
                    }),

                TextColumn::make('status')
                    ->badge()
                    ->color(fn (string $state): string => match ($state) {
                        'available' => 'success',
                        'rented' => 'warning',
                        'maintenance' => 'info',
                        'retired' => 'gray',
                    }),

                TextColumn::make('purchase_date')
                    ->date()
                    ->sortable()
                    ->toggleable(),

                TextColumn::make('purchase_price')
                    ->money('IDR')
                    ->sortable(),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                EditAction::make(),
                DeleteAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\Pages\CreateProduct.php
================================================================================

<?php

namespace App\Filament\Resources\Products\Pages;

use App\Filament\Resources\Products\ProductResource;
use Filament\Resources\Pages\CreateRecord;

class CreateProduct extends CreateRecord
{
    protected static string $resource = ProductResource::class;
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\Pages\EditProduct.php
================================================================================

<?php

namespace App\Filament\Resources\Products\Pages;

use App\Filament\Resources\Products\ProductResource;
use Filament\Actions\DeleteAction;
use Filament\Resources\Pages\EditRecord;

class EditProduct extends EditRecord
{
    protected static string $resource = ProductResource::class;

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\Pages\ListProducts.php
================================================================================

<?php

namespace App\Filament\Resources\Products\Pages;

use App\Filament\Resources\Products\ProductResource;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;

class ListProducts extends ListRecords
{
    protected static string $resource = ProductResource::class;

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\ProductResource.php
================================================================================

<?php

namespace App\Filament\Resources\Products;

use App\Filament\Resources\Products\Pages\CreateProduct;
use App\Filament\Resources\Products\Pages\EditProduct;
use App\Filament\Resources\Products\Pages\ListProducts;
use App\Filament\Resources\Products\Schemas\ProductForm;
use App\Filament\Resources\Products\Tables\ProductsTable;
use App\Models\Product;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class ProductResource extends Resource
{
    protected static ?string $model = Product::class;

    protected static ?string $recordTitleAttribute = 'name';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-cube';
    
    protected static string|UnitEnum|null $navigationGroup = 'Inventory';
    
    protected static ?int $navigationSort = 4;
    
    protected static ?string $navigationLabel = 'Products';

    public static function form(Schema $schema): Schema
    {
        return ProductForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return ProductsTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            //
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListProducts::route('/'),
            'create' => CreateProduct::route('/create'),
            'edit' => EditProduct::route('/{record}/edit'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\Schemas\ProductForm.php
================================================================================

<?php

namespace App\Filament\Resources\Products\Schemas;

use App\Models\Brand;
use App\Models\Category;
use Filament\Forms\Components\FileUpload;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Forms\Components\Toggle;
use Filament\Schemas\Schema;
use Illuminate\Support\Str;

class ProductForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Select::make('category_id')
                    ->label('Category')
                    ->options(Category::where('is_active', true)->pluck('name', 'id'))
                    ->required()
                    ->searchable(),

                Select::make('brand_id')
                    ->label('Brand')
                    ->options(Brand::where('is_active', true)->pluck('name', 'id'))
                    ->required()
                    ->searchable(),

                TextInput::make('name')
                    ->required()
                    ->maxLength(255)
                    ->live(onBlur: true)
                    ->afterStateUpdated(function (string $state, callable $set) {
                        $set('slug', Str::slug($state));
                    }),

                TextInput::make('slug')
                    ->required()
                    ->maxLength(255)
                    ->unique(ignoreRecord: true),

                Textarea::make('description')
                    ->rows(3)
                    ->columnSpanFull(),

                TextInput::make('daily_rate')
                    ->label('Daily Rate (Rp)')
                    ->required()
                    ->numeric()
                    ->prefix('Rp')
                    ->default(0),

                FileUpload::make('image')
                    ->image()
                    ->directory('products'),

                Toggle::make('is_active')
                    ->default(true),
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Products\Tables\ProductsTable.php
================================================================================

<?php

namespace App\Filament\Resources\Products\Tables;

use Filament\Actions\BulkActionGroup;
use Filament\Actions\DeleteBulkAction;
use Filament\Actions\EditAction;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\ImageColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;

class ProductsTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('category.name')
                    ->searchable(),
                TextColumn::make('brand.name')
                    ->searchable(),
                TextColumn::make('name')
                    ->searchable(),
                TextColumn::make('slug')
                    ->searchable(),
                TextColumn::make('daily_rate')
                    ->numeric()
                    ->sortable(),
                ImageColumn::make('image'),
                IconColumn::make('is_active')
                    ->boolean(),
                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
                TextColumn::make('updated_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                EditAction::make(),
            ])
            ->toolbarActions([
                BulkActionGroup::make([
                    DeleteBulkAction::make(),
                ]),
            ]);
    }
}


================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\CreateRental.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use Filament\Actions\Action;
use Filament\Resources\Pages\CreateRecord;
use Filament\Notifications\Notification;

class CreateRental extends CreateRecord
{
    protected static string $resource = RentalResource::class;

    protected function getFormActions(): array
    {
        return [
            Action::make('calculate')
                ->label('Calculate Total')
                ->icon('heroicon-m-calculator')
                ->color('info')
                ->action(function () {
                    $items = $this->data['items'] ?? [];
                    $subtotal = 0;

                    foreach ($items as $key => $item) {
                        $dailyRate = (float) ($item['daily_rate'] ?? 0);
                        $days = (int) ($item['days'] ?? 1);
                        $itemSubtotal = $dailyRate * $days;
                        
                        $this->data['items'][$key]['subtotal'] = $itemSubtotal;
                        $subtotal += $itemSubtotal;
                    }

                    $discount = (float) ($this->data['discount'] ?? 0);
                    $total = $subtotal - $discount;

                    $this->data['subtotal'] = $subtotal;
                    $this->data['total'] = $total;

                    Notification::make()
                        ->title('Calculated!')
                        ->body("Subtotal: Rp " . number_format($subtotal, 0, ',', '.') . " | Total: Rp " . number_format($total, 0, ',', '.'))
                        ->success()
                        ->send();
                }),
            
            $this->getCreateFormAction(),
            $this->getCreateAnotherFormAction(),
            $this->getCancelFormAction(),
        ];
    }

    protected function afterCreate(): void
    {
        $this->record->refresh();
        
        $subtotal = $this->record->items()->sum('subtotal');
        $total = $subtotal - ($this->record->discount ?? 0);

        $this->record->update([
            'subtotal' => $subtotal,
            'total' => $total,
        ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\EditRental.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Rental;
use Filament\Actions\DeleteAction;
use Filament\Notifications\Notification;
use Filament\Resources\Pages\EditRecord;

class EditRental extends EditRecord
{
    protected static string $resource = RentalResource::class;

    public function mount(int|string $record): void
    {
        parent::mount($record);

        // Check if rental can be edited
        if (!$this->record->canBeEdited()) {
            Notification::make()
                ->title('Cannot edit this rental')
                ->body('This rental is currently active and cannot be edited.')
                ->danger()
                ->send();

            $this->redirect(RentalResource::getUrl('index'));
        }
    }

    protected function getHeaderActions(): array
    {
        return [
            DeleteAction::make()
                ->visible(fn () => $this->record->canBeDeleted()),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\ListRentals.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Rental;
use Filament\Actions\CreateAction;
use Filament\Resources\Pages\ListRecords;
use Illuminate\Support\Facades\DB;

class ListRentals extends ListRecords
{
    protected static string $resource = RentalResource::class;

    public function mount(): void
    {
        $this->updateLateStatuses();
        
        parent::mount();
    }

    protected function updateLateStatuses(): void
    {
        $now = now();

        // Update late pickups - gunakan DB::table untuk bypass model events
        DB::table('rentals')
            ->where('status', 'pending')
            ->where('start_date', '<', $now)
            ->update(['status' => 'late_pickup', 'updated_at' => $now]);

        // Update late returns
        DB::table('rentals')
            ->where('status', 'active')
            ->where('end_date', '<', $now)
            ->update(['status' => 'late_return', 'updated_at' => $now]);
    }

    protected function getHeaderActions(): array
    {
        return [
            CreateAction::make(),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\Rentals\PickupOperation.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Rental;
use App\Models\RentalItemKit;
use Filament\Actions\Action;
use Filament\Forms\Components\Hidden;
use Filament\Forms\Components\Placeholder;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Notifications\Notification;
use Filament\Resources\Pages\Page;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Concerns\InteractsWithTable;
use Filament\Tables\Contracts\HasTable;
use Filament\Tables\Table;
use Illuminate\Contracts\Support\Htmlable;

class PickupOperation extends Page implements HasTable
{
    use InteractsWithTable;

    protected static string $resource = RentalResource::class;

    public ?Rental $rental = null;

    public function getView(): string
    {
        return 'filament.resources.rentals.pages.pickup-operation';
    }

    public function mount(int|string $record): void
    {
        $this->rental = Rental::with(['customer', 'items.productUnit.product', 'items.productUnit.kits', 'items.rentalItemKits'])->findOrFail($record);

        // Update late status on mount
        $this->rental->checkAndUpdateLateStatus();
        $this->rental->refresh();

        if (!in_array($this->rental->status, [Rental::STATUS_PENDING, Rental::STATUS_LATE_PICKUP])) {
            Notification::make()
                ->title('Cannot pickup this rental')
                ->body('This rental is not in pending or late pickup status.')
                ->danger()
                ->send();

            $this->redirect(RentalResource::getUrl('index'));
        }
    }

    public function getTitle(): string|Htmlable
    {
        return 'Pickup Operation - ' . $this->rental->rental_code;
    }

    public function getAvailabilityStatus(): array
    {
        $conflicts = $this->rental->checkAvailability();

        return [
            'available' => empty($conflicts),
            'conflicts' => $conflicts,
        ];
    }

    public function isItemKitChecked($item): bool
    {
        $unitKitsCount = $item->productUnit->kits->count();
        $rentalItemKitsCount = $item->rentalItemKits->count();

        return $unitKitsCount > 0 && $rentalItemKitsCount >= $unitKitsCount;
    }

    public function allItemsKitChecked(): bool
    {
        foreach ($this->rental->items as $item) {
            if ($item->productUnit->kits->count() > 0 && !$this->isItemKitChecked($item)) {
                return false;
            }
        }
        return true;
    }

    public function table(Table $table): Table
    {
        return $table
            ->query($this->rental->items()->getQuery())
            ->columns([
                TextColumn::make('productUnit.product.name')
                    ->label('Product')
                    ->searchable(),

                TextColumn::make('productUnit.serial_number')
                    ->label('Serial Number')
                    ->searchable(),

                TextColumn::make('kits_count')
                    ->label('Kits')
                    ->getStateUsing(fn ($record) => $record->productUnit->kits->count() . ' kits')
                    ->badge()
                    ->color('info'),

                TextColumn::make('days')
                    ->label('Days'),
            ])
            ->recordActions([
                \Filament\Actions\Action::make('kit_check')
                    ->label(fn ($record) => $this->isItemKitChecked($record) ? 'Kit Checked' : 'Kit Check')
                    ->icon(fn ($record) => $this->isItemKitChecked($record) ? 'heroicon-o-check-circle' : 'heroicon-o-exclamation-circle')
                    ->color(fn ($record) => $this->isItemKitChecked($record) ? 'success' : 'warning')
                    ->modalHeading(fn ($record) => 'Kit Check - ' . $record->productUnit->serial_number)
                    ->modalWidth('2xl')
                    ->form(function ($record) {
                        $kits = $record->productUnit->kits;

                        if ($kits->isEmpty()) {
                            return [
                                Placeholder::make('no_kits')
                                    ->label('')
                                    ->content('No kits available for this unit.'),
                            ];
                        }

                        $existingKits = $record->rentalItemKits->keyBy('unit_kit_id');

                        return [
                            Repeater::make('kits')
                                ->label('Kit Items')
                                ->schema([
                                    Hidden::make('kit_id'),

                                    TextInput::make('kit_name')
                                        ->label('Kit Name')
                                        ->disabled()
                                        ->dehydrated(false)
                                        ->columnSpan(1),

                                    TextInput::make('serial_number')
                                        ->label('Serial Number')
                                        ->disabled()
                                        ->dehydrated(false)
                                        ->columnSpan(1),

                                    Select::make('condition_out')
                                        ->label('Condition Out')
                                        ->options(RentalItemKit::getConditionOptions())
                                        ->required()
                                        ->columnSpan(1),

                                    Textarea::make('notes')
                                        ->label('Notes')
                                        ->rows(1)
                                        ->placeholder('Optional notes')
                                        ->columnSpan(1),
                                ])
                                ->columns(4)
                                ->itemLabel(fn (array $state): ?string => $state['kit_name'] ?? null)
                                ->default(function () use ($kits, $existingKits) {
                                    return $kits->map(function ($kit) use ($existingKits) {
                                        $existing = $existingKits->get($kit->id);
                                        return [
                                            'kit_id' => $kit->id,
                                            'kit_name' => $kit->name,
                                            'serial_number' => $kit->serial_number ?? '-',
                                            'condition_out' => $existing?->condition_out ?? $kit->condition,
                                            'notes' => $existing?->notes ?? '',
                                        ];
                                    })->toArray();
                                })
                                ->addable(false)
                                ->deletable(false)
                                ->reorderable(false),
                        ];
                    })
                    ->action(function ($record, array $data) {
                        foreach ($data['kits'] ?? [] as $kitData) {
                            if (isset($kitData['kit_id']) && $kitData['kit_id']) {
                                $record->rentalItemKits()->updateOrCreate(
                                    ['unit_kit_id' => $kitData['kit_id']],
                                    [
                                        'condition_out' => $kitData['condition_out'] ?? 'good',
                                        'notes' => $kitData['notes'] ?? null,
                                    ]
                                );
                            }
                        }

                        $this->rental->load(['items.rentalItemKits', 'items.productUnit.kits']);

                        Notification::make()
                            ->title('Kit conditions saved')
                            ->success()
                            ->send();
                    })
                    ->visible(fn ($record) => $record->productUnit->kits->count() > 0),
            ])
            ->headerActions([])
            ->paginated(false);
    }

    protected function getHeaderActions(): array
    {
        return [
            Action::make('edit_rental')
                ->label('Edit Rental')
                ->icon('heroicon-o-pencil-square')
                ->color('gray')
                ->url(fn () => RentalResource::getUrl('edit', ['record' => $this->rental])),

            $this->getValidatePickupAction(),
        ];
    }

    public function getValidatePickupAction(): Action
    {
        return Action::make('validate_pickup')
            ->label('Validate Pickup')
            ->icon('heroicon-o-check-circle')
            ->color('success')
            ->size('lg')
            ->requiresConfirmation()
            ->modalHeading('Confirm Pickup')
            ->modalDescription('Are you sure the customer has picked up all items? This will change the rental status to Active.')
            ->modalSubmitActionLabel('Yes, Confirm Pickup')
            ->disabled(fn () => !$this->allItemsKitChecked())
            ->action(function () {
                $this->rental->validatePickup();

                Notification::make()
                    ->title('Pickup validated successfully')
                    ->body('Rental status changed to Active.')
                    ->success()
                    ->send();

                $this->redirect(RentalResource::getUrl('index'));
            });
    }

    public function validatePickupAction(): Action
    {
        return $this->getValidatePickupAction();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\Rentals\ProcessReturn.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Rental;
use App\Models\RentalItemKit;
use Filament\Actions\Action;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\Hidden;
use Filament\Forms\Components\Placeholder;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Notifications\Notification;
use Filament\Resources\Pages\Page;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Concerns\InteractsWithTable;
use Filament\Tables\Contracts\HasTable;
use Filament\Tables\Table;
use Illuminate\Contracts\Support\Htmlable;

class ProcessReturn extends Page implements HasTable
{
    use InteractsWithTable;

    protected static string $resource = RentalResource::class;

    public ?Rental $rental = null;

    public function getView(): string
    {
        return 'filament.resources.rentals.pages.return-operation';
    }

    public function mount(int|string $record): void
    {
        $this->rental = Rental::with(['customer', 'items.productUnit.product', 'items.rentalItemKits.unitKit'])->findOrFail($record);

        // Update late status on mount
        $this->rental->checkAndUpdateLateStatus();
        $this->rental->refresh();

        if (!in_array($this->rental->status, [Rental::STATUS_ACTIVE, Rental::STATUS_LATE_RETURN])) {
            Notification::make()
                ->title('Cannot return this rental')
                ->body('This rental is not in active or late return status.')
                ->danger()
                ->send();

            $this->redirect(RentalResource::getUrl('index'));
        }
    }

    public function getTitle(): string|Htmlable
    {
        return 'Return Operation - ' . $this->rental->rental_code;
    }

    public function isItemReturnChecked($item): bool
    {
        if ($item->rentalItemKits->isEmpty()) {
            return true;
        }

        foreach ($item->rentalItemKits as $kit) {
            if (!$kit->is_returned || !$kit->condition_in) {
                return false;
            }
        }
        return true;
    }

    public function allItemsReturnChecked(): bool
    {
        foreach ($this->rental->items as $item) {
            if (!$this->isItemReturnChecked($item)) {
                return false;
            }
        }
        return true;
    }

    public function canValidateReturn(): bool
    {
        return $this->allItemsReturnChecked();
    }

    public function table(Table $table): Table
    {
        return $table
            ->query($this->rental->items()->getQuery())
            ->columns([
                TextColumn::make('productUnit.product.name')
                    ->label('Product')
                    ->searchable(),

                TextColumn::make('productUnit.serial_number')
                    ->label('Serial Number')
                    ->searchable(),

                TextColumn::make('kits_status')
                    ->label('Kits')
                    ->getStateUsing(fn ($record) => $record->getKitsStatusText())
                    ->badge()
                    ->color(fn ($record) => $record->allKitsReturned() ? 'success' : 'warning'),

                TextColumn::make('days')
                    ->label('Days'),

                IconColumn::make('all_returned')
                    ->label('Returned')
                    ->boolean()
                    ->getStateUsing(fn ($record) => $record->allKitsReturned())
                    ->trueIcon('heroicon-o-check-circle')
                    ->falseIcon('heroicon-o-x-circle')
                    ->trueColor('success')
                    ->falseColor('danger'),
            ])
            ->recordActions([
                \Filament\Actions\Action::make('kit_check')
                    ->label(fn ($record) => $this->isItemReturnChecked($record) ? 'Kit Checked' : 'Kit Check')
                    ->icon(fn ($record) => $this->isItemReturnChecked($record) ? 'heroicon-o-check-circle' : 'heroicon-o-exclamation-circle')
                    ->color(fn ($record) => $this->isItemReturnChecked($record) ? 'success' : 'warning')
                    ->modalHeading(fn ($record) => 'Kit Check - ' . $record->productUnit->serial_number)
                    ->modalWidth('2xl')
                    ->form(function ($record) {
                        $rentalItemKits = $record->rentalItemKits;

                        if ($rentalItemKits->isEmpty()) {
                            return [
                                Placeholder::make('no_kits')
                                    ->label('')
                                    ->content('No kits tracked for this rental item.'),
                            ];
                        }

                        return [
                            Repeater::make('kits')
                                ->label('Kit Items')
                                ->schema([
                                    Hidden::make('id'),

                                    TextInput::make('kit_name')
                                        ->label('Kit Name')
                                        ->disabled()
                                        ->dehydrated(false)
                                        ->columnSpan(1),

                                    TextInput::make('serial_number')
                                        ->label('Serial Number')
                                        ->disabled()
                                        ->dehydrated(false)
                                        ->columnSpan(1),

                                    TextInput::make('condition_out')
                                        ->label('Condition Out')
                                        ->disabled()
                                        ->dehydrated(false)
                                        ->columnSpan(1),

                                    Select::make('condition_in')
                                        ->label('Condition In')
                                        ->options(RentalItemKit::getConditionInOptions())
                                        ->required()
                                        ->columnSpan(1),

                                    Checkbox::make('is_returned')
                                        ->label('Returned')
                                        ->default(true)
                                        ->columnSpan(1),

                                    Textarea::make('notes')
                                        ->label('Notes')
                                        ->rows(1)
                                        ->placeholder('Notes if damaged/lost')
                                        ->columnSpan(1),
                                ])
                                ->columns(6)
                                ->itemLabel(fn (array $state): ?string => $state['kit_name'] ?? null)
                                ->default(function () use ($rentalItemKits) {
                                    return $rentalItemKits->map(function ($rentalItemKit) {
                                        return [
                                            'id' => $rentalItemKit->id,
                                            'kit_name' => $rentalItemKit->unitKit->name,
                                            'serial_number' => $rentalItemKit->unitKit->serial_number ?? '-',
                                            'condition_out' => ucfirst($rentalItemKit->condition_out),
                                            'condition_in' => $rentalItemKit->condition_in ?? $rentalItemKit->condition_out,
                                            'is_returned' => $rentalItemKit->is_returned ?? true,
                                            'notes' => $rentalItemKit->notes,
                                        ];
                                    })->toArray();
                                })
                                ->addable(false)
                                ->deletable(false)
                                ->reorderable(false),
                        ];
                    })
                    ->action(function ($record, array $data) {
                        foreach ($data['kits'] ?? [] as $kitData) {
                            if (isset($kitData['id']) && $kitData['id']) {
                                RentalItemKit::where('id', $kitData['id'])
                                    ->update([
                                        'condition_in' => $kitData['condition_in'] ?? null,
                                        'is_returned' => $kitData['is_returned'] ?? false,
                                        'notes' => $kitData['notes'] ?? null,
                                    ]);
                            }
                        }

                        $this->rental->load(['items.rentalItemKits.unitKit']);

                        Notification::make()
                            ->title('Kit return status updated')
                            ->success()
                            ->send();
                    })
                    ->visible(fn ($record) => $record->rentalItemKits->count() > 0),
            ])
            ->headerActions([])
            ->paginated(false);
    }

    protected function getHeaderActions(): array
    {
        return [
            $this->getValidateReturnAction(),
        ];
    }

    public function getValidateReturnAction(): Action
    {
        return Action::make('validate_return')
            ->label('Validate Return')
            ->icon('heroicon-o-check-circle')
            ->color('success')
            ->size('lg')
            ->requiresConfirmation()
            ->modalHeading('Confirm Return')
            ->modalDescription('Are you sure all items have been returned? This will change the rental status to Completed.')
            ->modalSubmitActionLabel('Yes, Confirm Return')
            ->disabled(fn () => !$this->canValidateReturn())
            ->action(function () {
                $this->rental->validateReturn();

                Notification::make()
                    ->title('Return validated successfully')
                    ->body('Rental status changed to Completed.')
                    ->success()
                    ->send();

                $this->redirect(RentalResource::getUrl('index'));
            });
    }

    public function validateReturnAction(): Action
    {
        return $this->getValidateReturnAction();
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Pages\Rentals\ViewRental.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Pages;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Rental;
use Filament\Resources\Pages\Page;
use Illuminate\Contracts\Support\Htmlable;

class ViewRental extends Page
{
    protected static string $resource = RentalResource::class;

    protected static bool $canCreateAnother = false;

    public ?Rental $rental = null;

    public function getView(): string
    {
        return 'filament.resources.rentals.pages.view-rental';
    }

    public function mount(int|string $record): void
    {
        $this->rental = Rental::with([
            'customer',
            'items.productUnit.product',
            'items.rentalItemKits.unitKit'
        ])->findOrFail($record);
    }

    public function getTitle(): string|Htmlable
    {
        return 'View Rental - ' . $this->rental->rental_code;
    }

    protected function getHeaderActions(): array
    {
        return [];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\RelationManagers\ItemsRelationManager.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\RelationManagers;

use App\Models\RentalItem;
use Filament\Actions\Action;
use Filament\Actions\DeleteAction;
use Filament\Actions\EditAction;
use Filament\Actions\ViewAction;
use Filament\Forms\Components\Checkbox;
use Filament\Forms\Components\Placeholder;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Notifications\Notification;
use Filament\Resources\RelationManagers\RelationManager;
use Filament\Schemas\Schema;
use Filament\Tables\Columns\IconColumn;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;
use Illuminate\Database\Eloquent\Model;

class ItemsRelationManager extends RelationManager
{
    protected static string $relationship = 'items';

    protected static ?string $title = 'Rental Items & Kits';

    protected static ?string $recordTitleAttribute = 'product_unit_id';

    public function table(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('productUnit.product.name')
                    ->label('Product')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('productUnit.serial_number')
                    ->label('Serial Number')
                    ->searchable(),

                TextColumn::make('daily_rate')
                    ->label('Daily Rate')
                    ->money('IDR'),

                TextColumn::make('days')
                    ->label('Days'),

                TextColumn::make('subtotal')
                    ->label('Subtotal')
                    ->money('IDR'),

                TextColumn::make('rentalItemKits_count')
                    ->label('Kits')
                    ->counts('rentalItemKits')
                    ->badge()
                    ->color('info'),

                IconColumn::make('all_kits_returned')
                    ->label('Kits Returned')
                    ->boolean()
                    ->getStateUsing(fn (RentalItem $record): bool => $record->allKitsReturned())
                    ->trueIcon('heroicon-o-check-circle')
                    ->falseIcon('heroicon-o-x-circle')
                    ->trueColor('success')
                    ->falseColor('danger'),
            ])
            ->filters([
                //
            ])
            ->recordActions([
                Action::make('manage_kits')
                    ->label('Manage Kits')
                    ->icon('heroicon-o-wrench-screwdriver')
                    ->color('warning')
                    ->modalHeading(fn (RentalItem $record) => 'Manage Kits - ' . $record->productUnit->serial_number)
                    ->modalWidth('xl')
                    ->form(function (RentalItem $record) {
                        return [
                            Placeholder::make('unit_info')
                                ->label('Unit')
                                ->content($record->productUnit->product->name . ' - ' . $record->productUnit->serial_number),

                            Repeater::make('kits')
                                ->label('Kit Items')
                                ->schema([
                                    TextInput::make('kit_name')
                                        ->label('Kit Name')
                                        ->disabled()
                                        ->dehydrated(false),

                                    TextInput::make('serial_number')
                                        ->label('Serial Number')
                                        ->disabled()
                                        ->dehydrated(false),

                                    Select::make('condition_out')
                                        ->label('Condition Out')
                                        ->options([
                                            'excellent' => 'Excellent',
                                            'good' => 'Good',
                                            'fair' => 'Fair',
                                            'poor' => 'Poor',
                                        ])
                                        ->disabled()
                                        ->dehydrated(false),

                                    Select::make('condition_in')
                                        ->label('Condition In')
                                        ->options([
                                            'excellent' => 'Excellent',
                                            'good' => 'Good',
                                            'fair' => 'Fair',
                                            'poor' => 'Poor',
                                        ])
                                        ->placeholder('Not returned yet'),

                                    Checkbox::make('is_returned')
                                        ->label('Returned'),

                                    Textarea::make('notes')
                                        ->label('Notes')
                                        ->rows(2)
                                        ->placeholder('e.g., damaged, missing'),
                                ])
                                ->columns(3)
                                ->default(function () use ($record) {
                                    return $record->rentalItemKits->map(function ($rentalItemKit) {
                                        return [
                                            'id' => $rentalItemKit->id,
                                            'kit_name' => $rentalItemKit->unitKit->name,
                                            'serial_number' => $rentalItemKit->unitKit->serial_number ?? '-',
                                            'condition_out' => $rentalItemKit->condition_out,
                                            'condition_in' => $rentalItemKit->condition_in,
                                            'is_returned' => $rentalItemKit->is_returned,
                                            'notes' => $rentalItemKit->notes,
                                        ];
                                    })->toArray();
                                })
                                ->addable(false)
                                ->deletable(false)
                                ->reorderable(false),
                        ];
                    })
                    ->action(function (RentalItem $record, array $data) {
                        foreach ($data['kits'] as $kitData) {
                            $record->rentalItemKits()
                                ->where('id', $kitData['id'])
                                ->update([
                                    'condition_in' => $kitData['condition_in'],
                                    'is_returned' => $kitData['is_returned'] ?? false,
                                    'notes' => $kitData['notes'],
                                ]);
                        }

                        // Update unit kit condition if returned
                        foreach ($data['kits'] as $kitData) {
                            if ($kitData['is_returned'] && $kitData['condition_in']) {
                                $rentalItemKit = $record->rentalItemKits()->find($kitData['id']);
                                $rentalItemKit?->unitKit->update(['condition' => $kitData['condition_in']]);
                            }
                        }

                        Notification::make()
                            ->title('Kits updated successfully')
                            ->success()
                            ->send();
                    })
                    ->visible(fn (RentalItem $record) => $record->rentalItemKits()->count() > 0),

                Action::make('attach_kits')
                    ->label('Attach Kits')
                    ->icon('heroicon-o-plus-circle')
                    ->color('success')
                    ->requiresConfirmation()
                    ->modalHeading('Attach Kits from Unit')
                    ->modalDescription(fn (RentalItem $record) => "This will attach all kits from {$record->productUnit->serial_number} to this rental item.")
                    ->action(function (RentalItem $record) {
                        $record->attachKitsFromUnit();

                        Notification::make()
                            ->title('Kits attached successfully')
                            ->success()
                            ->send();
                    })
                    ->visible(fn (RentalItem $record) => 
                        $record->rentalItemKits()->count() === 0 && 
                        $record->productUnit->kits()->count() > 0
                    ),

                ViewAction::make(),
            ])
            ->headerActions([
                //
            ])
            ->toolbarActions([
                //
            ]);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\RentalResource.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals;

use App\Filament\Resources\Rentals\Pages\CreateRental;
use App\Filament\Resources\Rentals\Pages\EditRental;
use App\Filament\Resources\Rentals\Pages\ListRentals;
use App\Filament\Resources\Rentals\Pages\PickupOperation;
use App\Filament\Resources\Rentals\Pages\ProcessReturn;
use App\Filament\Resources\Rentals\Pages\ViewRental;
use App\Filament\Resources\Rentals\Schemas\RentalForm;
use App\Filament\Resources\Rentals\Tables\RentalsTable;
use App\Models\Rental;
use BackedEnum;
use Filament\Resources\Resource;
use Filament\Schemas\Schema;
use Filament\Tables\Table;
use UnitEnum;

class RentalResource extends Resource
{
    protected static ?string $model = Rental::class;

    protected static ?string $recordTitleAttribute = 'rental_code';

    // Navigation Configuration
    protected static string|BackedEnum|null $navigationIcon = 'heroicon-o-calendar-days';
    
    protected static string|UnitEnum|null $navigationGroup = 'Rentals';
    
    protected static ?int $navigationSort = 1;
    
    protected static ?string $navigationLabel = 'Rentals';

    public static function form(Schema $schema): Schema
    {
        return RentalForm::configure($schema);
    }

    public static function table(Table $table): Table
    {
        return RentalsTable::configure($table);
    }

    public static function getRelations(): array
    {
        return [
            //
        ];
    }

    public static function getPages(): array
    {
        return [
            'index' => ListRentals::route('/'),
            'create' => CreateRental::route('/create'),
            'edit' => EditRental::route('/{record}/edit'),
            'pickup' => PickupOperation::route('/{record}/pickup'),
            'return' => ProcessReturn::route('/{record}/return'),
            'view' => ViewRental::route('/{record}/view'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Schemas\RentalForm.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Schemas;

use App\Models\Customer;
use App\Models\ProductUnit;
use App\Models\Rental;
use Filament\Forms\Components\DateTimePicker;
use Filament\Forms\Components\Placeholder;
use Filament\Forms\Components\Repeater;
use Filament\Forms\Components\Select;
use Filament\Forms\Components\Textarea;
use Filament\Forms\Components\TextInput;
use Filament\Schemas\Schema;
use Carbon\Carbon;

class RentalForm
{
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                TextInput::make('rental_code')
                    ->label('Rental Code')
                    ->default('AUTO')
                    ->disabled()
                    ->dehydrated(false),

                Select::make('customer_id')
                    ->label('Customer')
                    ->options(Customer::where('is_active', true)->pluck('name', 'id'))
                    ->required()
                    ->searchable(),

                DateTimePicker::make('start_date')
                ->label('Start Date & Time')
                ->required()
                ->native(false)
                ->default(now())
                ->seconds(false)
                ->live()
                ->afterStateUpdated(function ($state, callable $get, callable $set) {
                    self::calculateDuration($get, $set);
                }),

                DateTimePicker::make('end_date')
                ->label('End Date & Time')
                ->required()
                ->native(false)
                ->default(now()->addDays(1))
                ->seconds(false)
                ->live()
                ->afterStateUpdated(function ($state, callable $get, callable $set) {
                    self::calculateDuration($get, $set);
                }),
                Select::make('status')
                    ->options(Rental::getStatusOptions())
                    ->required()
                    ->default('pending')
                    ->disabled(fn ($record) => $record && !$record->canBeEdited()),

                Placeholder::make('duration_display')
                    ->label('Rental Duration')
                    ->content(function (callable $get) {
                        $startDate = $get('start_date');
                        $endDate = $get('end_date');

                        if ($startDate && $endDate) {
                            $start = Carbon::parse($startDate);
                            $end = Carbon::parse($endDate);
                            
                            $totalHours = (int) $start->diffInHours($end);
                            $days = (int) floor($totalHours / 24);
                            $hours = $totalHours % 24;

                            if ($days > 0 && $hours > 0) {
                                return " {$days} hari {$hours} jam";
                            } elseif ($days > 0) {
                                return " {$days} hari";
                            } else {
                                return " {$hours} jam";
                            }
                        }

                        return '-';
                    })
                    ->columnSpanFull(),

                Repeater::make('items')
                    ->label('Rental Items')
                    ->relationship()
                    ->schema([
                        Select::make('product_unit_id')
                            ->label('Product Unit')
                            ->options(function (callable $get) {
                                $startDate = $get('../../start_date');
                                $endDate = $get('../../end_date');
                                $currentRentalId = $get('../../id');

                                return self::getAvailableUnits($startDate, $endDate, $currentRentalId);
                            })
                            ->required()
                            ->searchable()
                            ->live()
                            ->helperText(function (callable $get) {
                                $startDate = $get('../../start_date');
                                $endDate = $get('../../end_date');
                                
                                if (!$startDate || !$endDate) {
                                    return ' Pilih Start & End Date dulu untuk melihat unit yang tersedia';
                                }
                                
                                return ' Menampilkan unit yang tersedia untuk periode ini';
                            })
                            ->afterStateUpdated(function ($state, callable $get, callable $set) {
                                if ($state) {
                                    $unit = ProductUnit::with('product')->find($state);
                                    if ($unit) {
                                        $set('daily_rate', $unit->product->daily_rate);
                                        
                                        // Auto-set days from dates
                                        $startDate = $get('../../start_date');
                                        $endDate = $get('../../end_date');
                                        
                                        if ($startDate && $endDate) {
                                            $start = Carbon::parse($startDate);
                                            $end = Carbon::parse($endDate);
                                            $days = max(1, (int) ceil($start->diffInHours($end) / 24));
                                            $set('days', $days);
                                            $set('subtotal', $unit->product->daily_rate * $days);
                                        }
                                    }
                                }
                            })
                            ->disableOptionsWhenSelectedInSiblingRepeaterItems(),

                        TextInput::make('daily_rate')
                            ->label('Daily Rate')
                            ->numeric()
                            ->prefix('Rp')
                            ->required()
                            ->default(0)
                            ->live(onBlur: true)
                            ->afterStateUpdated(function ($state, callable $get, callable $set) {
                                $days = (int) ($get('days') ?? 1);
                                $set('subtotal', (float) $state * $days);
                            }),

                        TextInput::make('days')
                            ->label('Days')
                            ->numeric()
                            ->required()
                            ->default(1)
                            ->live(onBlur: true)
                            ->afterStateUpdated(function ($state, callable $get, callable $set) {
                                $dailyRate = (float) ($get('daily_rate') ?? 0);
                                $set('subtotal', $dailyRate * (int) $state);
                            }),

                        TextInput::make('subtotal')
                            ->label('Subtotal')
                            ->numeric()
                            ->prefix('Rp')
                            ->disabled()
                            ->dehydrated(true)
                            ->default(0),
                    ])
                    ->columns(4)
                    ->columnSpanFull()
                    ->defaultItems(1),

                TextInput::make('subtotal')
                    ->label('Subtotal')
                    ->numeric()
                    ->prefix('Rp')
                    ->default(0)
                    ->disabled()
                    ->dehydrated(true),

                TextInput::make('discount')
                    ->label('Discount')
                    ->numeric()
                    ->prefix('Rp')
                    ->default(0),

                TextInput::make('total')
                    ->label('Total')
                    ->numeric()
                    ->prefix('Rp')
                    ->default(0)
                    ->disabled()
                    ->dehydrated(true),

                TextInput::make('deposit')
                    ->label('Deposit')
                    ->numeric()
                    ->prefix('Rp')
                    ->default(0),

                Textarea::make('notes')
                    ->label('Notes')
                    ->rows(3)
                    ->columnSpanFull(),
            ]);
    }

    /**
     * Get available units for the given date range
     * Checks for overlapping rentals based on datetime
     */
    public static function getAvailableUnits($startDate, $endDate, $currentRentalId = null): array
    {
        if (!$startDate || !$endDate) {
            // If no dates selected, show all units with status indicator
            return ProductUnit::with('product')
                ->get()
                ->mapWithKeys(function ($unit) {
                    $statusLabel = $unit->status !== 'available' ? " [{$unit->status}]" : '';
                    return [$unit->id => $unit->product->name . ' - ' . $unit->serial_number . $statusLabel];
                })
                ->toArray();
        }

        $start = Carbon::parse($startDate);
        $end = Carbon::parse($endDate);

        // Get unit IDs that have overlapping rentals
        $overlappingUnitIds = Rental::where('status', '!=', 'cancelled')
            ->where('status', '!=', 'completed')
            ->when($currentRentalId, function ($query) use ($currentRentalId) {
                // Exclude current rental when editing
                $query->where('id', '!=', $currentRentalId);
            })
            ->where(function ($query) use ($start, $end) {
                // Check for any overlap:
                // Existing rental starts before new rental ends AND existing rental ends after new rental starts
                $query->where('start_date', '<', $end)
                      ->where('end_date', '>', $start);
            })
            ->with('items')
            ->get()
            ->pluck('items')
            ->flatten()
            ->pluck('product_unit_id')
            ->unique()
            ->toArray();

        // Get all units and mark availability
        return ProductUnit::with('product')
            ->get()
            ->mapWithKeys(function ($unit) use ($overlappingUnitIds) {
                $isBooked = in_array($unit->id, $overlappingUnitIds);
                
                if ($isBooked) {
                    return []; // Don't include booked units
                }
                
                return [$unit->id => $unit->product->name . ' - ' . $unit->serial_number];
            })
            ->filter() // Remove empty entries
            ->toArray();
    }

    // Calculate duration and update days in items
    public static function calculateDuration(callable $get, callable $set): void
    {
        $startDate = $get('start_date');
        $endDate = $get('end_date');

        if ($startDate && $endDate) {
            $start = Carbon::parse($startDate);
            $end = Carbon::parse($endDate);
            
            $days = max(1, (int) ceil($start->diffInHours($end) / 24));

            // Update days in all items
            $items = $get('items') ?? [];
            foreach ($items as $key => $item) {
                $set("items.{$key}.days", $days);
                $dailyRate = (float) ($item['daily_rate'] ?? 0);
                $set("items.{$key}.subtotal", $dailyRate * $days);
            }
        }
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Resources\Rentals\Tables\RentalsTable.php
================================================================================

<?php

namespace App\Filament\Resources\Rentals\Tables;

use App\Filament\Resources\Rentals\RentalResource;
use App\Models\Delivery;
use App\Models\Rental;
use Barryvdh\DomPDF\Facade\Pdf;
use Filament\Actions\Action;
use Filament\Actions\ActionGroup;
use Filament\Actions\DeleteAction;
use Filament\Actions\EditAction;
use Filament\Forms\Components\Textarea;
use Filament\Notifications\Notification;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;
use Illuminate\Support\Facades\Auth;

class RentalsTable
{
    public static function configure(Table $table): Table
    {
        return $table
            ->columns([
                TextColumn::make('rental_code')
                    ->label('Rental Code')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('customer.name')
                    ->label('Customer')
                    ->searchable()
                    ->sortable(),

                TextColumn::make('start_date')
                    ->dateTime('d M Y H:i')
                    ->sortable(),

                TextColumn::make('end_date')
                    ->dateTime('d M Y H:i')
                    ->sortable(),

                TextColumn::make('status')
                    ->badge()
                    ->getStateUsing(fn (Rental $record): string => $record->getRealTimeStatus())
                    ->color(fn (string $state): string => Rental::getStatusColor($state))
                    ->formatStateUsing(fn (string $state): string => ucfirst(str_replace('_', ' ', $state))),

                TextColumn::make('total')
                    ->money('IDR')
                    ->sortable(),

                TextColumn::make('created_at')
                    ->dateTime()
                    ->sortable()
                    ->toggleable(isToggledHiddenByDefault: true),
            ])
            ->defaultSort('created_at', 'desc')
            ->filters([])
            ->recordActions([
                // Pickup button
                Action::make('pickup')
                    ->label('Pickup')
                    ->icon('heroicon-o-truck')
                    ->color('success')
                    ->url(fn (Rental $record) => RentalResource::getUrl('pickup', ['record' => $record]))
                    ->visible(fn (Rental $record) => in_array($record->getRealTimeStatus(), [
                        Rental::STATUS_PENDING,
                        Rental::STATUS_LATE_PICKUP,
                    ])),

                // Return button
                Action::make('return')
                    ->label('Return')
                    ->icon('heroicon-o-arrow-uturn-left')
                    ->color('info')
                    ->url(fn (Rental $record) => RentalResource::getUrl('return', ['record' => $record]))
                    ->visible(fn (Rental $record) => in_array($record->getRealTimeStatus(), [
                        Rental::STATUS_ACTIVE,
                        Rental::STATUS_LATE_RETURN,
                    ])),

                // Documents dropdown
                ActionGroup::make([
                    // Quotation PDF
                    Action::make('download_quotation')
                        ->label('Download Quotation')
                        ->icon('heroicon-o-document-text')
                        ->color('gray')
                        ->action(function (Rental $record) {
                            $record->load(['customer', 'items.productUnit.product']);
                            
                            $pdf = Pdf::loadView('pdf.quotation', ['rental' => $record]);
                            
                            return response()->streamDownload(
                                fn () => print($pdf->output()),
                                'Quotation-' . $record->rental_code . '.pdf'
                            );
                        }),

                    // Invoice PDF
                    Action::make('download_invoice')
                        ->label('Download Invoice')
                        ->icon('heroicon-o-document-currency-dollar')
                        ->color('gray')
                        ->action(function (Rental $record) {
                            $record->load(['customer', 'items.productUnit.product']);
                            
                            $pdf = Pdf::loadView('pdf.invoice', ['rental' => $record]);
                            
                            return response()->streamDownload(
                                fn () => print($pdf->output()),
                                'Invoice-' . $record->rental_code . '.pdf'
                            );
                        }),

                    // Create Delivery Out
                    Action::make('create_delivery_out')
                        ->label('Create Surat Jalan Keluar')
                        ->icon('heroicon-o-truck')
                        ->color('warning')
                        ->requiresConfirmation()
                        ->modalHeading('Create Surat Jalan Keluar')
                        ->modalDescription('This will create a new delivery document for check-out.')
                        ->action(function (Rental $record) {
                            $existing = $record->deliveries()->where('type', 'out')->first();
                            if ($existing) {
                                Notification::make()
                                    ->title('Surat Jalan Keluar already exists')
                                    ->body('Delivery number: ' . $existing->delivery_number)
                                    ->warning()
                                    ->send();
                                return;
                            }

                            $delivery = Delivery::create([
                                'rental_id' => $record->getKey(),
                                'type' => 'out',
                                'date' => now(),
                                'checked_by' => Auth::id(),
                                'status' => 'draft',
                            ]);

                            foreach ($record->items as $rentalItem) {
                                $delivery->items()->create([
                                    'rental_item_id' => $rentalItem->getKey(),
                                    'rental_item_kit_id' => null,
                                    'is_checked' => false,
                                ]);

                                foreach ($rentalItem->rentalItemKits as $kit) {
                                    $delivery->items()->create([
                                        'rental_item_id' => $rentalItem->getKey(),
                                        'rental_item_kit_id' => $kit->getKey(),
                                        'is_checked' => false,
                                    ]);
                                }
                            }

                            Notification::make()
                                ->title('Surat Jalan Keluar created')
                                ->body('Delivery number: ' . $delivery->delivery_number)
                                ->success()
                                ->send();
                        })
                        ->visible(fn (Rental $record) => in_array($record->getRealTimeStatus(), [
                            Rental::STATUS_PENDING,
                            Rental::STATUS_LATE_PICKUP,
                            Rental::STATUS_ACTIVE,
                        ]) && !$record->deliveries()->where('type', 'out')->exists()),

                    // Create Delivery In
                    Action::make('create_delivery_in')
                        ->label('Create Surat Jalan Masuk')
                        ->icon('heroicon-o-arrow-uturn-left')
                        ->color('success')
                        ->requiresConfirmation()
                        ->modalHeading('Create Surat Jalan Masuk')
                        ->modalDescription('This will create a new delivery document for check-in.')
                        ->action(function (Rental $record) {
                            $existing = $record->deliveries()->where('type', 'in')->first();
                            if ($existing) {
                                Notification::make()
                                    ->title('Surat Jalan Masuk already exists')
                                    ->body('Delivery number: ' . $existing->delivery_number)
                                    ->warning()
                                    ->send();
                                return;
                            }

                            $delivery = Delivery::create([
                                'rental_id' => $record->getKey(),
                                'type' => 'in',
                                'date' => now(),
                                'checked_by' => Auth::id(),
                                'status' => 'draft',
                            ]);

                            foreach ($record->items as $rentalItem) {
                                $delivery->items()->create([
                                    'rental_item_id' => $rentalItem->getKey(),
                                    'rental_item_kit_id' => null,
                                    'is_checked' => false,
                                ]);

                                foreach ($rentalItem->rentalItemKits as $kit) {
                                    $delivery->items()->create([
                                        'rental_item_id' => $rentalItem->getKey(),
                                        'rental_item_kit_id' => $kit->getKey(),
                                        'is_checked' => false,
                                    ]);
                                }
                            }

                            Notification::make()
                                ->title('Surat Jalan Masuk created')
                                ->body('Delivery number: ' . $delivery->delivery_number)
                                ->success()
                                ->send();
                        })
                        ->visible(fn (Rental $record) => in_array($record->getRealTimeStatus(), [
                            Rental::STATUS_ACTIVE,
                            Rental::STATUS_LATE_RETURN,
                        ]) && !$record->deliveries()->where('type', 'in')->exists()),
                ])
                ->label('Documents')
                ->icon('heroicon-o-document-duplicate')
                ->color('gray')
                ->button(),

                // Edit button
                EditAction::make()
                    ->visible(fn (Rental $record) => $record->canBeEdited()),

                // Cancel button
                Action::make('cancel')
                    ->label('Cancel')
                    ->icon('heroicon-o-x-circle')
                    ->color('danger')
                    ->requiresConfirmation()
                    ->modalHeading('Cancel Rental')
                    ->modalDescription('Are you sure you want to cancel this rental?')
                    ->form([
                        Textarea::make('cancel_reason')
                            ->label('Reason for cancellation')
                            ->required()
                            ->rows(3),
                    ])
                    ->action(function (Rental $record, array $data) {
                        $record->cancelRental($data['cancel_reason']);

                        Notification::make()
                            ->title('Rental cancelled')
                            ->success()
                            ->send();
                    })
                    ->visible(fn (Rental $record) => in_array($record->getRealTimeStatus(), [
                        Rental::STATUS_PENDING,
                        Rental::STATUS_LATE_PICKUP,
                    ])),

                // Delete button
                DeleteAction::make()
                    ->visible(fn (Rental $record) => $record->canBeDeleted()),
            ])
            ->recordUrl(function (Rental $record) {
                $status = $record->getRealTimeStatus();

                return match (true) {
                    in_array($status, [Rental::STATUS_PENDING, Rental::STATUS_LATE_PICKUP]) 
                        => RentalResource::getUrl('pickup', ['record' => $record]),
                    in_array($status, [Rental::STATUS_ACTIVE, Rental::STATUS_LATE_RETURN]) 
                        => RentalResource::getUrl('return', ['record' => $record]),
                    in_array($status, [Rental::STATUS_COMPLETED, Rental::STATUS_CANCELLED]) 
                        => RentalResource::getUrl('view', ['record' => $record]),
                    default => null,
                };
            })
            ->poll('30s');
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Widgets\LatestRentals.php
================================================================================

<?php

namespace App\Filament\Widgets;

use App\Models\Rental;
use Filament\Tables\Columns\TextColumn;
use Filament\Tables\Table;
use Filament\Widgets\TableWidget as BaseWidget;

class LatestRentals extends BaseWidget
{
    protected static ?int $sort = 2;

    protected int|string|array $columnSpan = 'full';

    public function table(Table $table): Table
    {
        return $table
            ->query(Rental::query()->latest()->limit(10))
            ->columns([
                TextColumn::make('rental_code')
                    ->label('Code')
                    ->searchable(),

                TextColumn::make('customer.name')
                    ->label('Customer')
                    ->searchable(),

                TextColumn::make('start_date')
                    ->label('Period')
                    ->formatStateUsing(fn (Rental $record) => $record->start_date->format('d M') . ' - ' . $record->end_date->format('d M Y')),

                TextColumn::make('total')
                    ->money('IDR')
                    ->sortable(),

                TextColumn::make('status')
                    ->badge()
                    ->color(fn (string $state) => Rental::getStatusColor($state)),

                TextColumn::make('created_at')
                    ->label('Created')
                    ->since(),
            ])
            ->paginated(false);
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Widgets\RentalCalendarWidget.php
================================================================================

<?php

namespace App\Filament\Widgets;

use App\Models\Rental;
use Illuminate\Database\Eloquent\Model;
use Saade\FilamentFullCalendar\Widgets\FullCalendarWidget;
use Saade\FilamentFullCalendar\Data\EventData;

class RentalCalendarWidget extends FullCalendarWidget
{
    // agar PHP 8.2 tidak error ketika trait/plugin mengakses $record
    public Model|int|string|null $record = null;

    public function fetchEvents(array $info): array
    {
        $start = $info['start'] ?? null;
        $end = $info['end'] ?? null;

        $query = Rental::query()->with(['customer', 'items.productUnit.product']);

        if ($start && $end) {
            $query->where(function ($q) use ($start, $end) {
                $q->where('start_date', '<', $end)
                  ->where('end_date', '>', $start);
            });
        }

        $rentals = $query->whereIn('status', ['pending', 'active', 'completed'])->get();

        return $rentals->map(function (Rental $rental) {
            $color = match ($rental->status) {
                'pending' => '#f59e0b',
                'active' => '#10b981',
                'completed' => '#3b82f6',
                'cancelled' => '#ef4444',
                default => '#6b7280',
            };

            $items = $rental->items->map(function ($item) {
                $pu = $item->productUnit;
                return ($pu?->product?->name ?? '-') . ' (' . ($pu->serial_number ?? '-') . ')';
            })->join(', ');

            return EventData::make()
                ->id($rental->id)
                ->title($rental->customer->name . '  ' . ($rental->rental_code ?? ''))
                ->start($rental->start_date?->toIso8601String())
                ->end($rental->end_date?->toIso8601String())
                ->backgroundColor($color)
                ->borderColor($color)
                ->extendedProps([
                    'status' => $rental->status,
                    'items' => $items,
                    'total' => 'Rp ' . number_format($rental->total ?? 0, 0, ',', '.'),
                ]);
        })->toArray();
    }

    public function eventDidMount(): string
    {
        // Pasang click listener pada tiap event (capture) untuk mencegah modal bawaan.
        // Juga lakukan satu kali setup global: intercept klik pada toolbar/create button agar redirect ke create page.
        return <<<JS
            function({ event, el, view }) {
                // tooltip + pointer
                el.setAttribute('title', event.title + "  " + (event.extendedProps.items || ""));
                el.style.cursor = 'pointer';

                // pastikan klik event langsung meredirect dan mencegah handler plugin lainnya
                el.addEventListener('click', function(ev) {
                    try { ev.preventDefault(); ev.stopImmediatePropagation(); } catch(e) {}
                    window.location.href = '/admin/rentals/' + event.id + '/edit';
                }, true);

                // satu kali global setup (per halaman) untuk intercept tombol "Create"/"New"
                if (!window.__filament_rental_calendar_setup_done) {
                    window.__filament_rental_calendar_setup_done = true;

                    // Intercept clicks on calendar toolbar buttons (delegated capture listener).
                    document.addEventListener('click', function(e) {
                        var t = e.target;
                        // cari tombol fc-button atau button dalam toolbar
                        var btn = t.closest && t.closest('.fc-button, button, a');
                        if (!btn) return;

                        // If the button text or aria-label indicates a Create/New action, intercept it.
                        var text = (btn.innerText || btn.textContent || '').trim().toLowerCase();
                        var aria = (btn.getAttribute && btn.getAttribute('aria-label') || '').trim().toLowerCase();

                        if (text.includes('create') || text.includes('new') || aria.includes('create') || aria.includes('new')) {
                            try { e.preventDefault(); e.stopImmediatePropagation(); } catch(err) {}
                            // redirect to Filament create page
                            window.location.href = '/admin/rentals/create';
                        }
                    }, true);

                    // Also intercept clicks that open modal content via Livewire (modal close/open buttons not always fc-button)
                    // Watch DOM mutations: if a Filament modal with title "Create" appears, redirect to create page.
                    try {
                        var observer = new MutationObserver(function(mutations) {
                            for (var i=0;i<mutations.length;i++){
                                var m = mutations[i];
                                for (var j=0;j<m.addedNodes.length;j++){
                                    var node = m.addedNodes[j];
                                    if (!(node instanceof HTMLElement)) continue;
                                    // Filament modal root often contains role="dialog" or class 'filament-modal'
                                    if (node.matches && (node.matches('.filament-modal') || node.querySelector && node.querySelector('[data-testid="filament-modal"]'))) {
                                        var titleEl = node.querySelector && (node.querySelector('.filament-modal__heading, h2, h3') || node.querySelector('[data-testid="modal-title"]'));
                                        var title = titleEl ? (titleEl.innerText || '').trim().toLowerCase() : '';
                                        if (title === 'create' || title.includes('create')) {
                                            // close the modal if possible (try clicking cancel), then redirect
                                            var cancelBtn = node.querySelector('button:contains("Cancel"), button:contains("cancel")');
                                            // just redirect immediately (user will land on full create form)
                                            window.location.href = '/admin/rentals/create';
                                        }
                                    }
                                }
                            }
                        });
                        observer.observe(document.body, { childList: true, subtree: true });
                    } catch (e) {
                        // ignore observer errors in older browsers
                    }
                }
            }
        JS;
    }

    public function config(): array
    {
        return [
            'firstDay' => 1,
            // toolbar tanpa tombol create (we handle create via blade button or global intercept)
            'headerToolbar' => [
                'left' => 'prev,next today',
                'center' => 'title',
                'right' => 'dayGridMonth,timeGridWeek,listWeek',
            ],
            // pastikan interaksi yang memicu create dimatikan
            'selectable' => false,
            'editable' => false,
            'selectMirror' => false,
            // handle dateClick: redirect to create with start date
            'dateClick' => "function(info) {
                try {
                    if (info.jsEvent) { info.jsEvent.preventDefault(); info.jsEvent.stopPropagation(); }
                } catch(e){}
                var params = new URLSearchParams();
                params.set('start', info.dateStr);
                window.location.href = '/admin/rentals/create?' + params.toString();
            }",
            'eventDisplay' => 'block',
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Widgets\RentalChart.php
================================================================================

<?php

namespace App\Filament\Widgets;

use App\Models\Rental;
use Filament\Widgets\ChartWidget;
use Illuminate\Support\Carbon;

class RentalChart extends ChartWidget
{
    // PERBAIKAN: Hapus kata "static" dari property $heading
    protected ?string $heading = 'Rentals This Month';

    protected static ?int $sort = 3;

    protected function getData(): array
    {
        $now = Carbon::now();
        $startOfMonth = $now->copy()->startOfMonth();
        $endOfMonth = $now->copy()->endOfMonth();

        // Get daily rental counts for current month
        $rentals = Rental::whereBetween('created_at', [$startOfMonth, $endOfMonth])
            ->selectRaw('DATE(created_at) as date, COUNT(*) as count')
            ->groupBy('date')
            ->orderBy('date')
            ->get();

        // Prepare data for chart
        $labels = [];
        $data = [];

        for ($date = $startOfMonth->copy(); $date->lte($endOfMonth); $date->addDay()) {
            $labels[] = $date->format('M d');
            $rental = $rentals->firstWhere('date', $date->format('Y-m-d'));
            $data[] = $rental ? $rental->count : 0;
        }

        return [
            'datasets' => [
                [
                    'label' => 'Rentals',
                    'data' => $data,
                    'borderColor' => 'rgb(59, 130, 246)',
                    'backgroundColor' => 'rgba(59, 130, 246, 0.1)',
                ],
            ],
            'labels' => $labels,
        ];
    }

    protected function getType(): string
    {
        return 'line';
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\app/Filament\Widgets\StatsOverview.php
================================================================================

<?php

namespace App\Filament\Widgets;

use App\Models\Customer;
use App\Models\Rental;
use App\Models\ProductUnit;
use Filament\Widgets\StatsOverviewWidget as BaseWidget;
use Filament\Widgets\StatsOverviewWidget\Stat;

class StatsOverview extends BaseWidget
{
    protected static ?int $sort = 1;

    protected function getStats(): array
    {
        $todayRentals = Rental::whereDate('created_at', today())->count();
        $todayRevenue = Rental::whereDate('created_at', today())->sum('total');
        $activeRentals = Rental::whereIn('status', ['active', 'late_pickup', 'late_return'])->count();
        $pendingRentals = Rental::where('status', 'pending')->count();
        $availableUnits = ProductUnit::where('status', 'available')->count();
        $rentedUnits = ProductUnit::where('status', 'rented')->count();
        $totalCustomers = Customer::count();
        $verifiedCustomers = Customer::where('is_verified', true)->count();

        return [
            Stat::make('Today\'s Rentals', $todayRentals)
                ->description('New bookings today')
                ->descriptionIcon('heroicon-m-arrow-trending-up')
                ->color('success'),

            Stat::make('Today\'s Revenue', 'Rp ' . number_format($todayRevenue, 0, ',', '.'))
                ->description('Total revenue today')
                ->descriptionIcon('heroicon-m-currency-dollar')
                ->color('success'),

            Stat::make('Active Rentals', $activeRentals)
                ->description($pendingRentals . ' pending approval')
                ->descriptionIcon('heroicon-m-clock')
                ->color('warning'),

            Stat::make('Equipment Status', $availableUnits . ' / ' . ($availableUnits + $rentedUnits))
                ->description($rentedUnits . ' currently rented')
                ->descriptionIcon('heroicon-m-cube')
                ->color('info'),

            Stat::make('Customers', $totalCustomers)
                ->description($verifiedCustomers . ' verified')
                ->descriptionIcon('heroicon-m-users')
                ->color('primary'),

            Stat::make('Pending Verification', Customer::where('is_verified', false)->count())
                ->description('Awaiting document review')
                ->descriptionIcon('heroicon-m-document-check')
                ->color('danger'),
        ];
    }
}

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\0001_01_01_000000_create_users_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->timestamp('email_verified_at')->nullable();
            $table->string('password');
            $table->rememberToken();
            $table->timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table->string('email')->primary();
            $table->string('token');
            $table->timestamp('created_at')->nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->foreignId('user_id')->nullable()->index();
            $table->string('ip_address', 45)->nullable();
            $table->text('user_agent')->nullable();
            $table->longText('payload');
            $table->integer('last_activity')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('users');
        Schema::dropIfExists('password_reset_tokens');
        Schema::dropIfExists('sessions');
    }
};


================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\0001_01_01_000001_create_cache_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('cache', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->mediumText('value');
            $table->integer('expiration')->index();
        });

        Schema::create('cache_locks', function (Blueprint $table) {
            $table->string('key')->primary();
            $table->string('owner');
            $table->integer('expiration')->index();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('cache');
        Schema::dropIfExists('cache_locks');
    }
};


================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\0001_01_01_000002_create_jobs_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('jobs', function (Blueprint $table) {
            $table->id();
            $table->string('queue')->index();
            $table->longText('payload');
            $table->unsignedTinyInteger('attempts');
            $table->unsignedInteger('reserved_at')->nullable();
            $table->unsignedInteger('available_at');
            $table->unsignedInteger('created_at');
        });

        Schema::create('job_batches', function (Blueprint $table) {
            $table->string('id')->primary();
            $table->string('name');
            $table->integer('total_jobs');
            $table->integer('pending_jobs');
            $table->integer('failed_jobs');
            $table->longText('failed_job_ids');
            $table->mediumText('options')->nullable();
            $table->integer('cancelled_at')->nullable();
            $table->integer('created_at');
            $table->integer('finished_at')->nullable();
        });

        Schema::create('failed_jobs', function (Blueprint $table) {
            $table->id();
            $table->string('uuid')->unique();
            $table->text('connection');
            $table->text('queue');
            $table->longText('payload');
            $table->longText('exception');
            $table->timestamp('failed_at')->useCurrent();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('jobs');
        Schema::dropIfExists('job_batches');
        Schema::dropIfExists('failed_jobs');
    }
};


================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_113330_create_categories_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('categories', function (Blueprint $table) {
            $table->id();
            $table->string('name');                    // Nama kategori
            $table->string('slug')->unique();          // URL-friendly name
            $table->text('description')->nullable();   // Deskripsi (opsional)
            $table->string('image')->nullable();       // Gambar kategori (opsional)
            $table->boolean('is_active')->default(true); // Status aktif
            $table->timestamps();                      // created_at & updated_at
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('categories');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_114011_create_brands_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('brands', function (Blueprint $table) {
            $table->id();
            $table->string('name');                    // Nama brand
            $table->string('slug')->unique();          // URL-friendly name
            $table->string('logo')->nullable();        // Logo brand
            $table->string('website')->nullable();     // Website brand (opsional)
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('brands');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_122508_create_products_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('products', function (Blueprint $table) {
            $table->id();
            $table->foreignId('category_id')->constrained()->cascadeOnDelete();
            $table->foreignId('brand_id')->constrained()->cascadeOnDelete();
            $table->string('name');
            $table->string('slug')->unique();
            $table->text('description')->nullable();
            $table->decimal('daily_rate', 12, 2);          // Harga sewa per hari
            $table->string('image')->nullable();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('products');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_123037_create_product_units_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('product_units', function (Blueprint $table) {
            $table->id();
            $table->foreignId('product_id')->constrained()->cascadeOnDelete();
            $table->string('serial_number')->unique();
            $table->enum('condition', ['excellent', 'good', 'fair', 'poor'])->default('excellent');
            $table->enum('status', ['available', 'rented', 'maintenance', 'retired'])->default('available');
            $table->text('notes')->nullable();
            $table->date('purchase_date')->nullable();
            $table->decimal('purchase_price', 12, 2)->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('product_units');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_124356_create_customers_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('customers', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('email')->unique();
            $table->string('phone');
            $table->string('id_card_number')->nullable();      // KTP
            $table->string('id_card_image')->nullable();       // Foto KTP
            $table->text('address')->nullable();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('customers');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_125127_create_rentals_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('rentals', function (Blueprint $table) {
            $table->id();
            $table->string('rental_code')->unique();           // RNT-20260130-001
            $table->foreignId('customer_id')->constrained()->cascadeOnDelete();
            $table->date('start_date');
            $table->date('end_date');
            $table->date('returned_date')->nullable();         // Tanggal dikembalikan
            $table->enum('status', ['pending', 'active', 'completed', 'cancelled'])->default('pending');
            $table->decimal('subtotal', 12, 2)->default(0);
            $table->decimal('discount', 12, 2)->default(0);
            $table->decimal('total', 12, 2)->default(0);
            $table->decimal('deposit', 12, 2)->default(0);     // Uang jaminan
            $table->text('notes')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('rentals');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_125156_create_rental_items_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('rental_items', function (Blueprint $table) {
            $table->id();
            $table->foreignId('rental_id')->constrained()->cascadeOnDelete();
            $table->foreignId('product_unit_id')->constrained()->cascadeOnDelete();
            $table->decimal('daily_rate', 12, 2);              // Harga sewa per hari
            $table->integer('days');                            // Jumlah hari
            $table->decimal('subtotal', 12, 2);                // daily_rate x days
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('rental_items');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_130728_update_rentals_table_nullable_fields.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->decimal('subtotal', 12, 2)->default(0)->change();
            $table->decimal('discount', 12, 2)->default(0)->change();
            $table->decimal('total', 12, 2)->default(0)->change();
            $table->decimal('deposit', 12, 2)->default(0)->change();
        });
    }

    public function down(): void
    {
        // 
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_01_30_141709_change_date_columns_to_datetime_in_rentals_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->dateTime('start_date')->change();
            $table->dateTime('end_date')->change();
            $table->dateTime('returned_date')->nullable()->change();
        });
    }

    public function down(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->date('start_date')->change();
            $table->date('end_date')->change();
            $table->date('returned_date')->nullable()->change();
        });
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_115619_create_unit_kits_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('unit_kits', function (Blueprint $table) {
            $table->id();
            $table->foreignId('unit_id')->constrained('product_units')->cascadeOnDelete();
            $table->string('name');
            $table->string('serial_number')->nullable();
            $table->enum('condition', ['excellent', 'good', 'fair', 'poor'])->default('excellent');
            $table->text('notes')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('unit_kits');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_121637_create_rental_item_kits_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('rental_item_kits', function (Blueprint $table) {
            $table->id();
            $table->foreignId('rental_item_id')->constrained()->cascadeOnDelete();
            $table->foreignId('unit_kit_id')->constrained()->cascadeOnDelete();
            $table->enum('condition_out', ['excellent', 'good', 'fair', 'poor']); // Kondisi saat keluar
            $table->enum('condition_in', ['excellent', 'good', 'fair', 'poor'])->nullable(); // Kondisi saat kembali
            $table->boolean('is_returned')->default(false); // Apakah sudah dikembalikan
            $table->text('notes')->nullable(); // Catatan (misal: rusak, hilang)
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('rental_item_kits');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_131106_add_cancel_reason_to_rentals_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->text('cancel_reason')->nullable()->after('notes');
            
            // Update status enum to include new statuses
            // Note: For MySQL, you might need to modify the column
        });

        // Update status column to include new values
        DB::statement("ALTER TABLE rentals MODIFY COLUMN status ENUM('pending', 'late_pickup', 'active', 'late_return', 'completed', 'cancelled') DEFAULT 'pending'");
    }

    public function down(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->dropColumn('cancel_reason');
        });

        DB::statement("ALTER TABLE rentals MODIFY COLUMN status ENUM('pending', 'active', 'completed', 'cancelled') DEFAULT 'pending'");
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_165534_update_rentals_and_rental_item_kits_tables.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    public function up(): void
    {
        // Add cancel_reason to rentals
        Schema::table('rentals', function (Blueprint $table) {
            if (!Schema::hasColumn('rentals', 'cancel_reason')) {
                $table->text('cancel_reason')->nullable()->after('notes');
            }
        });

        // Fix condition_in enum to include lost and broken
        DB::statement("ALTER TABLE rental_item_kits MODIFY COLUMN condition_in ENUM('excellent', 'good', 'fair', 'poor', 'lost', 'broken') NULL");
    }

    public function down(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->dropColumn('cancel_reason');
        });

        DB::statement("ALTER TABLE rental_item_kits MODIFY COLUMN condition_in ENUM('excellent', 'good', 'fair', 'poor') NULL");
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_174307_create_deliveries_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('deliveries', function (Blueprint $table) {
            $table->id();
            $table->string('delivery_number')->unique();
            $table->foreignId('rental_id')->constrained()->cascadeOnDelete();
            $table->enum('type', ['out', 'in']);
            $table->date('date');
            $table->foreignId('checked_by')->nullable()->constrained('users');
            $table->enum('status', ['draft', 'completed'])->default('draft');
            $table->text('notes')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('deliveries');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_174336_create_delivery_items_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('delivery_items', function (Blueprint $table) {
            $table->id();
            $table->foreignId('delivery_id')->constrained()->cascadeOnDelete();
            $table->foreignId('rental_item_id')->constrained()->cascadeOnDelete();
            $table->foreignId('rental_item_kit_id')->nullable()->constrained()->cascadeOnDelete();
            $table->boolean('is_checked')->default(false);
            $table->enum('condition', ['excellent', 'good', 'fair', 'poor', 'lost', 'broken'])->nullable();
            $table->text('notes')->nullable();
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('delivery_items');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_182032_add_auth_fields_to_customers_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('customers', function (Blueprint $table) {
            if (!Schema::hasColumn('customers', 'password')) {
                $table->string('password')->nullable()->after('email');
            }
            if (!Schema::hasColumn('customers', 'email_verified_at')) {
                $table->timestamp('email_verified_at')->nullable()->after('password');
            }
            if (!Schema::hasColumn('customers', 'remember_token')) {
                $table->rememberToken()->after('email_verified_at');
            }
        });
    }

    public function down(): void
    {
        Schema::table('customers', function (Blueprint $table) {
            $table->dropColumn(['password', 'email_verified_at', 'remember_token']);
        });
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_182243_create_carts_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('carts', function (Blueprint $table) {
            $table->id();
            $table->foreignId('customer_id')->constrained()->cascadeOnDelete();
            $table->foreignId('product_unit_id')->constrained()->cascadeOnDelete();
            $table->dateTime('start_date');
            $table->dateTime('end_date');
            $table->integer('days')->default(1);
            $table->decimal('daily_rate', 12, 2);
            $table->decimal('subtotal', 12, 2);
            $table->timestamps();
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('carts');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_193226_create_document_types_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('document_types', function (Blueprint $table) {
            $table->id();
            $table->string('name');
            $table->string('code')->unique();
            $table->text('description')->nullable();
            $table->boolean('is_required')->default(false);
            $table->boolean('is_active')->default(true);
            $table->integer('sort_order')->default(0);
            $table->timestamps();
        });

        // Seed default document types
        $types = [
            ['name' => 'KTP', 'code' => 'ktp', 'description' => 'Kartu Tanda Penduduk', 'is_required' => true, 'sort_order' => 1],
            ['name' => 'SIM', 'code' => 'sim', 'description' => 'Surat Izin Mengemudi', 'is_required' => false, 'sort_order' => 2],
            ['name' => 'Kartu Keluarga', 'code' => 'kk', 'description' => 'Kartu Keluarga', 'is_required' => false, 'sort_order' => 3],
            ['name' => 'BPJS', 'code' => 'bpjs', 'description' => 'Kartu BPJS Kesehatan', 'is_required' => false, 'sort_order' => 4],
            ['name' => 'NPWP', 'code' => 'npwp', 'description' => 'Nomor Pokok Wajib Pajak', 'is_required' => false, 'sort_order' => 5],
            ['name' => 'Paspor', 'code' => 'passport', 'description' => 'Paspor', 'is_required' => false, 'sort_order' => 6],
            ['name' => 'KTM', 'code' => 'ktm', 'description' => 'Kartu Tanda Mahasiswa', 'is_required' => false, 'sort_order' => 7],
        ];

        foreach ($types as $type) {
            DB::table('document_types')->insert(array_merge($type, [
                'is_active' => true,
                'created_at' => now(),
                'updated_at' => now(),
            ]));
        }
    }

    public function down(): void
    {
        Schema::dropIfExists('document_types');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_193610_create_customer_documents_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('customer_documents', function (Blueprint $table) {
            $table->id();
            $table->foreignId('customer_id')->constrained()->cascadeOnDelete();
            $table->foreignId('document_type_id')->constrained()->cascadeOnDelete();
            $table->string('file_path');
            $table->string('file_name');
            $table->integer('file_size'); // in bytes
            $table->enum('status', ['pending', 'approved', 'rejected'])->default('pending');
            $table->text('rejection_reason')->nullable();
            $table->foreignId('verified_by')->nullable()->constrained('users')->nullOnDelete();
            $table->timestamp('verified_at')->nullable();
            $table->timestamps();

            $table->unique(['customer_id', 'document_type_id']);
        });
    }

    public function down(): void
    {
        Schema::dropIfExists('customer_documents');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_193629_update_customers_table_for_verification.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::table('customers', function (Blueprint $table) {
            // Drop old columns if exist
            if (Schema::hasColumn('customers', 'id_type')) {
                $table->dropColumn('id_type');
            }
            if (Schema::hasColumn('customers', 'id_card_image')) {
                $table->dropColumn('id_card_image');
            }

            // Add new columns
            if (!Schema::hasColumn('customers', 'nik')) {
                $table->string('nik', 16)->nullable()->after('phone');
            }
            if (!Schema::hasColumn('customers', 'is_verified')) {
                $table->boolean('is_verified')->default(false)->after('email_verified_at');
            }
            if (!Schema::hasColumn('customers', 'verified_at')) {
                $table->timestamp('verified_at')->nullable()->after('is_verified');
            }
            if (!Schema::hasColumn('customers', 'verified_by')) {
                $table->foreignId('verified_by')->nullable()->after('verified_at')->constrained('users')->nullOnDelete();
            }
        });
    }

    public function down(): void
    {
        Schema::table('customers', function (Blueprint $table) {
            $table->dropColumn(['nik', 'is_verified', 'verified_at', 'verified_by']);
        });
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_204142_create_discounts_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('discounts', function (Blueprint $table) {
            $table->id();
            $table->string('code')->unique();
            $table->string('name');
            $table->text('description')->nullable();
            $table->enum('type', ['percentage', 'fixed'])->default('percentage');
            $table->decimal('value', 12, 2);
            $table->decimal('min_rental_amount', 12, 2)->nullable();
            $table->decimal('max_discount_amount', 12, 2)->nullable();
            $table->integer('usage_limit')->nullable();
            $table->integer('usage_count')->default(0);
            $table->integer('per_customer_limit')->nullable();
            $table->date('start_date')->nullable();
            $table->date('end_date')->nullable();
            $table->boolean('is_active')->default(true);
            $table->timestamps();
        });

        Schema::table('rentals', function (Blueprint $table) {
            if (!Schema::hasColumn('rentals', 'discount_id')) {
                $table->foreignId('discount_id')->nullable()->after('customer_id')->constrained()->nullOnDelete();
            }
            if (!Schema::hasColumn('rentals', 'discount_code')) {
                $table->string('discount_code')->nullable()->after('discount_id');
            }
        });
    }

    public function down(): void
    {
        Schema::table('rentals', function (Blueprint $table) {
            $table->dropConstrainedForeignId('discount_id');
            $table->dropColumn('discount_code');
        });
        Schema::dropIfExists('discounts');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\database/migrations\2026_02_02_204243_create_settings_table.php
================================================================================

<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\DB;

return new class extends Migration
{
    public function up(): void
    {
        Schema::create('settings', function (Blueprint $table) {
            $table->id();
            $table->string('group')->default('general');
            $table->string('key')->unique();
            $table->text('value')->nullable();
            $table->string('type')->default('text');
            $table->string('label');
            $table->text('description')->nullable();
            $table->integer('sort_order')->default(0);
            $table->timestamps();
        });

        // Seed default settings
        $settings = [
            // General
            ['group' => 'general', 'key' => 'site_name', 'value' => 'Gearent', 'type' => 'text', 'label' => 'Site Name', 'sort_order' => 1],
            ['group' => 'general', 'key' => 'site_tagline', 'value' => 'Professional Equipment Rental', 'type' => 'text', 'label' => 'Tagline', 'sort_order' => 2],
            ['group' => 'general', 'key' => 'site_email', 'value' => 'info@gearent.com', 'type' => 'email', 'label' => 'Email', 'sort_order' => 3],
            ['group' => 'general', 'key' => 'site_phone', 'value' => '021-1234567', 'type' => 'text', 'label' => 'Phone', 'sort_order' => 4],
            ['group' => 'general', 'key' => 'site_address', 'value' => 'Jakarta, Indonesia', 'type' => 'textarea', 'label' => 'Address', 'sort_order' => 5],
            
            // Rental
            ['group' => 'rental', 'key' => 'deposit_percentage', 'value' => '30', 'type' => 'number', 'label' => 'Deposit Percentage (%)', 'sort_order' => 1],
            ['group' => 'rental', 'key' => 'late_fee_percentage', 'value' => '10', 'type' => 'number', 'label' => 'Late Fee per Day (%)', 'sort_order' => 2],
            ['group' => 'rental', 'key' => 'min_rental_days', 'value' => '1', 'type' => 'number', 'label' => 'Minimum Rental Days', 'sort_order' => 3],
            ['group' => 'rental', 'key' => 'max_rental_days', 'value' => '30', 'type' => 'number', 'label' => 'Maximum Rental Days', 'sort_order' => 4],
            
            // WhatsApp
            ['group' => 'whatsapp', 'key' => 'whatsapp_number', 'value' => '6281234567890', 'type' => 'text', 'label' => 'WhatsApp Number', 'sort_order' => 1],
            ['group' => 'whatsapp', 'key' => 'whatsapp_enabled', 'value' => '1', 'type' => 'boolean', 'label' => 'Enable WhatsApp Notification', 'sort_order' => 2],
        ];

        foreach ($settings as $setting) {
            DB::table('settings')->insert(array_merge($setting, [
                'created_at' => now(),
                'updated_at' => now(),
            ]));
        }
    }

    public function down(): void
    {
        Schema::dropIfExists('settings');
    }
};

================================================================================
FILE: D:\6. Kints\Projects\Gearent\routes\auth.php
================================================================================

<?php

use App\Http\Controllers\Auth\AuthenticatedSessionController;
use App\Http\Controllers\Auth\ConfirmablePasswordController;
use App\Http\Controllers\Auth\EmailVerificationNotificationController;
use App\Http\Controllers\Auth\EmailVerificationPromptController;
use App\Http\Controllers\Auth\NewPasswordController;
use App\Http\Controllers\Auth\PasswordController;
use App\Http\Controllers\Auth\PasswordResetLinkController;
use App\Http\Controllers\Auth\RegisteredUserController;
use App\Http\Controllers\Auth\VerifyEmailController;
use Illuminate\Support\Facades\Route;

Route::middleware('guest')->group(function () {
    Route::get('register', [RegisteredUserController::class, 'create'])
        ->name('register');

    Route::post('register', [RegisteredUserController::class, 'store']);

    Route::get('login', [AuthenticatedSessionController::class, 'create'])
        ->name('login');

    Route::post('login', [AuthenticatedSessionController::class, 'store']);

    Route::get('forgot-password', [PasswordResetLinkController::class, 'create'])
        ->name('password.request');

    Route::post('forgot-password', [PasswordResetLinkController::class, 'store'])
        ->name('password.email');

    Route::get('reset-password/{token}', [NewPasswordController::class, 'create'])
        ->name('password.reset');

    Route::post('reset-password', [NewPasswordController::class, 'store'])
        ->name('password.store');
});

Route::middleware('auth')->group(function () {
    Route::get('verify-email', EmailVerificationPromptController::class)
        ->name('verification.notice');

    Route::get('verify-email/{id}/{hash}', VerifyEmailController::class)
        ->middleware(['signed', 'throttle:6,1'])
        ->name('verification.verify');

    Route::post('email/verification-notification', [EmailVerificationNotificationController::class, 'store'])
        ->middleware('throttle:6,1')
        ->name('verification.send');

    Route::get('confirm-password', [ConfirmablePasswordController::class, 'show'])
        ->name('password.confirm');

    Route::post('confirm-password', [ConfirmablePasswordController::class, 'store']);

    Route::put('password', [PasswordController::class, 'update'])->name('password.update');

    Route::post('logout', [AuthenticatedSessionController::class, 'destroy'])
        ->name('logout');
});


================================================================================
FILE: D:\6. Kints\Projects\Gearent\routes\console.php
================================================================================

<?php

use Illuminate\Foundation\Inspiring;
use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Facades\Schedule;

Artisan::command('inspire', function () {
    $this->comment(Inspiring::quote());
})->purpose('Display an inspiring quote');

Schedule::command('rentals:check-late')->everyMinute();

================================================================================
FILE: D:\6. Kints\Projects\Gearent\routes\web.php
================================================================================

<?php

use App\Http\Controllers\Auth\CustomerAuthController;
use App\Http\Controllers\CartController;
use App\Http\Controllers\CatalogController;
use App\Http\Controllers\CheckoutController;
use App\Http\Controllers\CustomerDashboardController;
use App\Http\Controllers\HomeController;
use Illuminate\Support\Facades\Route;

// Public Routes
Route::get('/', [HomeController::class, 'index'])->name('home');

// Catalog
Route::get('/catalog', [CatalogController::class, 'index'])->name('catalog.index');
Route::get('/catalog/{product}', [CatalogController::class, 'show'])->name('catalog.show');
Route::post('/catalog/check-availability/{unit}', [CatalogController::class, 'checkAvailability'])->name('catalog.check-availability');

// Customer Auth
Route::middleware('customer.guest')->group(function () {
    Route::get('/login', [CustomerAuthController::class, 'showLoginForm'])->name('customer.login');
    Route::post('/login', [CustomerAuthController::class, 'login']);
    Route::get('/register', [CustomerAuthController::class, 'showRegistrationForm'])->name('customer.register');
    Route::post('/register', [CustomerAuthController::class, 'register']);
});

Route::post('/logout', [CustomerAuthController::class, 'logout'])->name('customer.logout')->middleware('customer.auth');

// Customer Protected Routes
Route::middleware('customer.auth')->prefix('customer')->name('customer.')->group(function () {
    // Dashboard
    Route::get('/dashboard', [CustomerDashboardController::class, 'index'])->name('dashboard');
    Route::get('/profile', [CustomerDashboardController::class, 'profile'])->name('profile');
    Route::put('/profile', [CustomerDashboardController::class, 'updateProfile'])->name('profile.update');
    Route::put('/password', [CustomerDashboardController::class, 'updatePassword'])->name('password.update');
    Route::get('/rentals', [CustomerDashboardController::class, 'rentals'])->name('rentals');
    Route::get('/rentals/{id}', [CustomerDashboardController::class, 'rentalDetail'])->name('rental.detail');
});

// Cart
Route::middleware('customer.auth')->group(function () {
    Route::get('/cart', [CartController::class, 'index'])->name('cart.index');
    Route::post('/cart/add', [CartController::class, 'add'])->name('cart.add');
    Route::put('/cart/{cart}', [CartController::class, 'update'])->name('cart.update');
    Route::delete('/cart/{cart}', [CartController::class, 'remove'])->name('cart.remove');
    Route::delete('/cart', [CartController::class, 'clear'])->name('cart.clear');

    // Checkout
    Route::get('/checkout', [CheckoutController::class, 'index'])->name('checkout.index');
    Route::post('/checkout', [CheckoutController::class, 'process'])->name('checkout.process');
    Route::get('/checkout/success/{rental}', [CheckoutController::class, 'success'])->name('checkout.success');
});

// Customer Documents
Route::middleware('customer.auth')->group(function () {
    Route::post('/customer/documents/upload', [App\Http\Controllers\CustomerDocumentController::class, 'upload'])->name('customer.documents.upload');
    Route::delete('/customer/documents/{document}', [App\Http\Controllers\CustomerDocumentController::class, 'delete'])->name('customer.documents.delete');
});
